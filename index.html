<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCMarket - Minecraft Content Marketplace</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ============================================
           MCMarket - Minecraft Content Marketplace
           All Styles Integrated
           ============================================ */

        /* ============ BASE & VARIABLES ============ */
        :root {
            --primary-green: #22c55e;
            --primary-green-hover: #16a34a;
            --admin-red: #ef4444;
            --admin-red-hover: #dc2626;
            --yellow-token: #fbbf24;
            --bg-dark: #1a1a2e;
            --bg-darker: #16213e;
            --bg-darkest: #0f3460;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        /* ============ GRADIENT BACKGROUND ============ */
        .gradient-bg {
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-darker) 50%, var(--bg-darkest) 100%);
            min-height: 100vh;
        }

        /* ============ CARD HOVER EFFECTS ============ */
        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        /* ============ TOKEN GLOW ANIMATION ============ */
        .token-glow {
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 5px #fbbf24; }
            to { box-shadow: 0 0 20px #fbbf24, 0 0 30px #f59e0b; }
        }

        /* ============ ADMIN GLOW ANIMATION ============ */
        .admin-glow {
            animation: adminGlow 2s ease-in-out infinite alternate;
        }

        @keyframes adminGlow {
            from { box-shadow: 0 0 5px #ef4444; }
            to { box-shadow: 0 0 20px #ef4444, 0 0 30px #dc2626; }
        }

        /* ============ FADE IN ANIMATION ============ */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ============ MODAL OVERLAY ============ */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        /* ============ DROPDOWN ANIMATION ============ */
        .dropdown-enter {
            animation: dropdownEnter 0.2s ease-out;
        }

        @keyframes dropdownEnter {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ============ CUSTOM BACKGROUNDS ============ */
        .bg-gray-750 {
            background-color: rgba(55, 65, 81, 0.5);
        }

        /* ============ SCROLLBAR STYLING ============ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1f2937;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }

        /* ============ CUSTOM SELECTION ============ */
        ::selection {
            background: rgba(34, 197, 94, 0.3);
            color: #fff;
        }

        /* ============ BUTTON TRANSITIONS ============ */
        button, a {
            transition: all 0.2s ease;
        }

        /* ============ INPUT FOCUS STYLES ============ */
        input:focus, select:focus, textarea:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.5);
        }

        /* ============ TABLE STYLES ============ */
        table {
            border-collapse: collapse;
        }

        th {
            font-weight: 600;
            text-align: left;
        }

        /* ============ LINE CLAMP ============ */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* ============ FOOTER STYLES ============ */
        .footer {
            background: linear-gradient(to top, rgba(17, 24, 39, 0.95), rgba(31, 41, 55, 0.8));
            border-top: 1px solid rgba(75, 85, 99, 0.5);
        }

        .footer-link {
            color: #9ca3af;
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .footer-link:hover {
            color: #ffffff;
        }

        /* ============ SOCIAL ICONS ============ */
        .social-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(75, 85, 99, 0.3);
            color: #9ca3af;
            transition: all 0.2s ease;
        }

        .social-icon:hover {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            transform: translateY(-2px);
        }

        /* ============ DIVIDER ============ */
        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(75, 85, 99, 0.5), transparent);
        }

        /* ============ LOADING SPINNER ============ */
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(34, 197, 94, 0.3);
            border-top-color: #22c55e;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div id="app"></div>

    <script>
        // ============ ADMIN CONFIG ============
        const ADMIN_EMAIL = 'admin@mcmarket.de';
        const ADMIN_PASSWORD = 'admin123';

        // ============ DATABASE SIMULATION ============
        const DB = {
            init() {
                if (!localStorage.getItem('mcmarket_init_v6')) {
                    localStorage.removeItem('mcmarket_init_v5');
                    localStorage.removeItem('mcmarket_init_v4');
                    localStorage.removeItem('mcmarket_init_v3');
                    localStorage.removeItem('mcmarket_users');
                    localStorage.removeItem('mcmarket_content');
                    localStorage.removeItem('mcmarket_purchases');
                    localStorage.removeItem('mcmarket_transactions');
                    localStorage.removeItem('mcmarket_settings');
                    localStorage.removeItem('mcmarket_files');
                    localStorage.removeItem('mcmarket_images');

                    const adminUser = {
                        id: 'admin_001',
                        username: 'SuperAdmin',
                        email: ADMIN_EMAIL,
                        password: ADMIN_PASSWORD,
                        role: 'admin',
                        tokens: Infinity,
                        isMainAdmin: true,
                        lastTokenClaim: null,
                        permissions: { 
                            canUpload: true, canSell: true, canView: true, canEarnTokens: true,
                            canManageUsers: true, canManageContent: true, canManageSettings: true,
                            canGiveTokens: true, isUnlimited: true
                        },
                        settings: {
                            theme: 'dark',
                            notifications: true,
                            emailNotifications: false,
                            language: 'de'
                        },
                        createdAt: new Date().toISOString()
                    };

                    localStorage.setItem('mcmarket_users', JSON.stringify([adminUser]));
                    localStorage.setItem('mcmarket_content', JSON.stringify([]));
                    localStorage.setItem('mcmarket_files', JSON.stringify({}));
                    localStorage.setItem('mcmarket_images', JSON.stringify({}));
                    localStorage.setItem('mcmarket_purchases', JSON.stringify([]));
                    localStorage.setItem('mcmarket_transactions', JSON.stringify([]));

                    const settings = {
                        tokenInterval: 'daily',
                        tokenAmount: 10,
                        uploadsEnabled: true,
                        salesEnabled: true,
                        tokenSystemEnabled: true,
                        requireApproval: true,
                        marketplaceEnabled: true,
                        registrationEnabled: true,
                        maintenanceMode: false,
                        welcomeTokens: 50,
                        maxFileSize: 5,
                        defaultUserPermissions: { canUpload: false, canSell: false, canView: true, canEarnTokens: true },
                        defaultCreatorPermissions: { canUpload: true, canSell: true, canView: true, canEarnTokens: true }
                    };
                    localStorage.setItem('mcmarket_settings', JSON.stringify(settings));
                    localStorage.setItem('mcmarket_init_v6', 'true');
                }
            },
            
            getFiles() { return JSON.parse(localStorage.getItem('mcmarket_files') || '{}'); },
            setFiles(files) { localStorage.setItem('mcmarket_files', JSON.stringify(files)); },
            
            getImages() { return JSON.parse(localStorage.getItem('mcmarket_images') || '{}'); },
            setImages(images) { localStorage.setItem('mcmarket_images', JSON.stringify(images)); },
            
            saveFile(contentId, fileData) {
                const files = this.getFiles();
                files[contentId] = fileData;
                this.setFiles(files);
            },
            
            saveImage(contentId, imageData) {
                const images = this.getImages();
                images[contentId] = imageData;
                this.setImages(images);
            },
            
            getFile(contentId) {
                return this.getFiles()[contentId] || null;
            },
            
            getImage(contentId) {
                return this.getImages()[contentId] || null;
            },

            getUsers() { 
                const users = JSON.parse(localStorage.getItem('mcmarket_users') || '[]');
                return users.map(u => {
                    if (u.email === ADMIN_EMAIL) {
                        u.tokens = Infinity;
                        u.permissions.isUnlimited = true;
                    }
                    if (!u.settings) {
                        u.settings = { theme: 'dark', notifications: true, emailNotifications: false, language: 'de' };
                    }
                    return u;
                });
            },
            setUsers(users) { 
                users = users.map(u => {
                    if (u.email === ADMIN_EMAIL) u.tokens = Infinity;
                    return u;
                });
                localStorage.setItem('mcmarket_users', JSON.stringify(users)); 
            },
            
            getContent() { return JSON.parse(localStorage.getItem('mcmarket_content') || '[]'); },
            setContent(content) { localStorage.setItem('mcmarket_content', JSON.stringify(content)); },
            
            getPurchases() { return JSON.parse(localStorage.getItem('mcmarket_purchases') || '[]'); },
            setPurchases(purchases) { localStorage.setItem('mcmarket_purchases', JSON.stringify(purchases)); },
            
            getTransactions() { return JSON.parse(localStorage.getItem('mcmarket_transactions') || '[]'); },
            setTransactions(trans) { localStorage.setItem('mcmarket_transactions', JSON.stringify(trans)); },
            
            getSettings() { return JSON.parse(localStorage.getItem('mcmarket_settings') || '{}'); },
            setSettings(settings) { localStorage.setItem('mcmarket_settings', JSON.stringify(settings)); },

            getCurrentUser() { 
                const userId = sessionStorage.getItem('mcmarket_currentUser');
                if (!userId) return null;
                const users = this.getUsers();
                const user = users.find(u => u.id === userId);
                if (user && user.email === ADMIN_EMAIL) user.tokens = Infinity;
                return user;
            },
            setCurrentUser(userId) { sessionStorage.setItem('mcmarket_currentUser', userId); },
            logout() { sessionStorage.removeItem('mcmarket_currentUser'); },

            isAdmin(user) {
                return user && (user.role === 'admin' || user.email === ADMIN_EMAIL);
            },
            
            updateUserSettings(userId, newSettings) {
                const users = this.getUsers();
                const idx = users.findIndex(u => u.id === userId);
                if (idx !== -1) {
                    users[idx].settings = { ...users[idx].settings, ...newSettings };
                    this.setUsers(users);
                    return true;
                }
                return false;
            }
        };

        // ============ APP STATE ============
        let currentView = 'login';
        let selectedContent = null;
        let filterState = { category: 'all', priceType: 'all', mcVersion: 'all', search: '' };
        let adminTab = 'overview';
        let uploadedImagePreview = null;

        // ============ UTILITY FUNCTIONS ============
        const Utils = {
            generateId: () => 'id_' + Math.random().toString(36).substr(2, 9),
            formatDate: (dateStr) => new Date(dateStr).toLocaleDateString('de-DE'),
            
            formatTokens(tokens) {
                if (tokens === Infinity || tokens === 'Infinity' || !isFinite(tokens)) return '‚àû';
                return tokens.toLocaleString('de-DE');
            },

            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 fade-in ${
                    type === 'success' ? 'bg-green-600' : type === 'error' ? 'bg-red-600' : 'bg-blue-600'
                }`;
                toast.textContent = message;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            },

            getCategoryIcon(cat) {
                const icons = { plugin: 'fa-puzzle-piece', mod: 'fa-cube', texturepack: 'fa-image', world: 'fa-globe' };
                return icons[cat] || 'fa-file';
            },

            getCategoryName(cat) {
                const names = { plugin: 'Plugin', mod: 'Mod', texturepack: 'Texturepack', world: 'Welt' };
                return names[cat] || cat;
            },

            canClaimTokens(user) {
                if (DB.isAdmin(user)) return false;
                const settings = DB.getSettings();
                if (!settings.tokenSystemEnabled || !user.permissions.canEarnTokens) return false;
                if (!user.lastTokenClaim) return true;
                const last = new Date(user.lastTokenClaim);
                const now = new Date();
                const diff = now - last;
                const intervals = { hourly: 3600000, daily: 86400000, weekly: 604800000, monthly: 2592000000 };
                return diff >= intervals[settings.tokenInterval];
            },

            getTimeUntilNextClaim(user) {
                if (DB.isAdmin(user)) return 'Unbegrenzt';
                const settings = DB.getSettings();
                if (!user.lastTokenClaim) return 'Jetzt verf√ºgbar!';
                const last = new Date(user.lastTokenClaim);
                const now = new Date();
                const intervals = { hourly: 3600000, daily: 86400000, weekly: 604800000, monthly: 2592000000 };
                const nextClaim = new Date(last.getTime() + intervals[settings.tokenInterval]);
                const diff = nextClaim - now;
                if (diff <= 0) return 'Jetzt verf√ºgbar!';
                const hours = Math.floor(diff / 3600000);
                const minutes = Math.floor((diff % 3600000) / 60000);
                if (hours > 24) return `${Math.floor(hours / 24)} Tag(e) ${hours % 24}h`;
                return `${hours}h ${minutes}m`;
            },
            
            formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' B';
                if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
                return (bytes / 1048576).toFixed(2) + ' MB';
            }
        };

        // ============ AUTH FUNCTIONS ============
        const Auth = {
            login(email, password) {
                const users = DB.getUsers();
                const user = users.find(u => u.email === email && u.password === password);
                if (user) {
                    DB.setCurrentUser(user.id);
                    return user;
                }
                return null;
            },

            register(username, email, password) {
                const users = DB.getUsers();
                const settings = DB.getSettings();
                if (!settings.registrationEnabled) return { error: 'Registrierung deaktiviert' };
                if (users.find(u => u.email === email)) return { error: 'E-Mail bereits registriert' };

                const newUser = {
                    id: Utils.generateId(),
                    username, email, password,
                    role: 'user',
                    tokens: settings.welcomeTokens || 50,
                    isMainAdmin: false,
                    lastTokenClaim: null,
                    permissions: { ...settings.defaultUserPermissions },
                    settings: { theme: 'dark', notifications: true, emailNotifications: false, language: 'de' },
                    createdAt: new Date().toISOString()
                };

                users.push(newUser);
                DB.setUsers(users);
                DB.setCurrentUser(newUser.id);
                return { success: true, user: newUser };
            },

            claimTokens() {
                const user = DB.getCurrentUser();
                if (!user || DB.isAdmin(user)) return false;
                if (!Utils.canClaimTokens(user)) return false;

                const settings = DB.getSettings();
                const users = DB.getUsers();
                const idx = users.findIndex(u => u.id === user.id);
                
                users[idx].tokens += settings.tokenAmount;
                users[idx].lastTokenClaim = new Date().toISOString();
                DB.setUsers(users);

                const transactions = DB.getTransactions();
                transactions.push({
                    id: Utils.generateId(),
                    userId: user.id,
                    type: 'earn',
                    amount: settings.tokenAmount,
                    description: `Token-Belohnung (${settings.tokenInterval})`,
                    date: new Date().toISOString()
                });
                DB.setTransactions(transactions);
                return true;
            }
        };

        // ============ CONTENT FUNCTIONS ============
        const Content = {
            purchase(contentId) {
                const user = DB.getCurrentUser();
                const content = DB.getContent().find(c => c.id === contentId);
                const settings = DB.getSettings();

                if (!user || !content) return false;
                
                if (DB.isAdmin(user)) {
                    const purchases = DB.getPurchases();
                    if (!purchases.find(p => p.userId === user.id && p.contentId === contentId)) {
                        purchases.push({ id: Utils.generateId(), userId: user.id, contentId, price: 0, date: new Date().toISOString() });
                        DB.setPurchases(purchases);
                    }
                    return true;
                }

                if (!settings.salesEnabled) return false;
                if (user.tokens < content.price) return false;

                const purchases = DB.getPurchases();
                if (purchases.find(p => p.userId === user.id && p.contentId === contentId)) return 'already';

                const users = DB.getUsers();
                const userIdx = users.findIndex(u => u.id === user.id);
                users[userIdx].tokens -= content.price;

                const creatorIdx = users.findIndex(u => u.id === content.uploaderId);
                if (creatorIdx !== -1 && !users[creatorIdx].isMainAdmin) {
                    users[creatorIdx].tokens += content.price;
                }
                DB.setUsers(users);

                purchases.push({ id: Utils.generateId(), userId: user.id, contentId, price: content.price, date: new Date().toISOString() });
                DB.setPurchases(purchases);

                const allContent = DB.getContent();
                const contentIdx = allContent.findIndex(c => c.id === contentId);
                allContent[contentIdx].downloads++;
                DB.setContent(allContent);

                const transactions = DB.getTransactions();
                transactions.push({ id: Utils.generateId(), userId: user.id, type: 'purchase', amount: -content.price, description: `Kauf: ${content.title}`, date: new Date().toISOString() });
                DB.setTransactions(transactions);
                return true;
            },

            hasPurchased(contentId) {
                const user = DB.getCurrentUser();
                if (!user) return false;
                if (DB.isAdmin(user)) return true;
                return DB.getPurchases().some(p => p.userId === user.id && p.contentId === contentId);
            }
        };

        // ============ ADMIN FUNCTIONS ============
        const Admin = {
            giveTokens(userId, amount) {
                const currentUser = DB.getCurrentUser();
                if (!DB.isAdmin(currentUser)) return false;
                const users = DB.getUsers();
                const idx = users.findIndex(u => u.id === userId);
                if (idx === -1) return false;
                users[idx].tokens = (users[idx].tokens || 0) + amount;
                DB.setUsers(users);
                const transactions = DB.getTransactions();
                transactions.push({ id: Utils.generateId(), userId, type: 'admin_give', amount, description: 'Tokens vom Admin erhalten', date: new Date().toISOString() });
                DB.setTransactions(transactions);
                return true;
            },

            setTokens(userId, amount) {
                const currentUser = DB.getCurrentUser();
                if (!DB.isAdmin(currentUser)) return false;
                const users = DB.getUsers();
                const idx = users.findIndex(u => u.id === userId);
                if (idx === -1) return false;
                users[idx].tokens = amount;
                DB.setUsers(users);
                return true;
            },

            setUserRole(userId, role) {
                const currentUser = DB.getCurrentUser();
                if (!DB.isAdmin(currentUser)) return false;
                const users = DB.getUsers();
                const idx = users.findIndex(u => u.id === userId);
                if (idx === -1 || users[idx].isMainAdmin) return false;
                users[idx].role = role;
                const settings = DB.getSettings();
                if (role === 'creator') users[idx].permissions = { ...settings.defaultCreatorPermissions };
                else if (role === 'user') users[idx].permissions = { ...settings.defaultUserPermissions };
                else if (role === 'admin') users[idx].permissions = { canUpload: true, canSell: true, canView: true, canEarnTokens: true, canManageUsers: true, canManageContent: true, canManageSettings: true };
                DB.setUsers(users);
                return true;
            },

            deleteUser(userId) {
                const currentUser = DB.getCurrentUser();
                if (!DB.isAdmin(currentUser)) return false;
                const users = DB.getUsers();
                const user = users.find(u => u.id === userId);
                if (!user || user.isMainAdmin) return false;
                DB.setUsers(users.filter(u => u.id !== userId));
                return true;
            },

            approveContent(contentId) {
                const currentUser = DB.getCurrentUser();
                if (!DB.isAdmin(currentUser)) return false;
                const content = DB.getContent();
                const idx = content.findIndex(c => c.id === contentId);
                if (idx === -1) return false;
                content[idx].approved = true;
                DB.setContent(content);
                return true;
            },

            deleteContent(contentId) {
                const currentUser = DB.getCurrentUser();
                if (!DB.isAdmin(currentUser)) return false;
                DB.setContent(DB.getContent().filter(c => c.id !== contentId));
                const files = DB.getFiles();
                delete files[contentId];
                DB.setFiles(files);
                const images = DB.getImages();
                delete images[contentId];
                DB.setImages(images);
                return true;
            },

            updateContentPrice(contentId, price) {
                const currentUser = DB.getCurrentUser();
                if (!DB.isAdmin(currentUser)) return false;
                const content = DB.getContent();
                const idx = content.findIndex(c => c.id === contentId);
                if (idx === -1) return false;
                content[idx].price = price;
                DB.setContent(content);
                return true;
            },

            updateSetting(key, value) {
                const currentUser = DB.getCurrentUser();
                if (!DB.isAdmin(currentUser)) return false;
                const settings = DB.getSettings();
                settings[key] = value;
                DB.setSettings(settings);
                return true;
            }
        };

        // ============ RENDER FUNCTIONS ============
        const Render = {
            app() {
                const user = DB.getCurrentUser();
                const app = document.getElementById('app');
                const settings = DB.getSettings();

                if (settings.maintenanceMode && (!user || !DB.isAdmin(user))) {
                    app.innerHTML = `
                        <div class="min-h-screen flex items-center justify-center">
                            <div class="text-center">
                                <i class="fas fa-tools text-6xl text-yellow-500 mb-4"></i>
                                <h1 class="text-3xl font-bold mb-2">Wartungsmodus</h1>
                                <p class="text-gray-400">Die Seite ist vor√ºbergehend nicht verf√ºgbar.</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                if (!user) {
                    this.authPage();
                    return;
                }

                app.innerHTML = `
                    ${this.navbar()}
                    <main class="container mx-auto px-4 py-6 min-h-screen">
                        <div id="content"></div>
                    </main>
                    ${this.footer()}
                `;
                this.navigate(currentView);
            },

            navbar() {
                const user = DB.getCurrentUser();
                const settings = DB.getSettings();
                const isAdmin = DB.isAdmin(user);
                const canClaim = !isAdmin && Utils.canClaimTokens(user);
                const canUpload = isAdmin || (user.permissions && user.permissions.canUpload);

                return `
                    <nav class="bg-gray-900/80 backdrop-blur-sm border-b ${isAdmin ? 'border-red-500/50' : 'border-gray-700'} sticky top-0 z-40">
                        <div class="container mx-auto px-4">
                            <div class="flex items-center justify-between h-16">
                                <div class="flex items-center space-x-8">
                                    <div class="flex items-center space-x-2 cursor-pointer" onclick="Render.navigate('marketplace')">
                                        <i class="fas fa-cube text-2xl text-green-500"></i>
                                        <span class="text-xl font-bold">MCMarket</span>
                                        ${isAdmin ? '<span class="text-xs bg-red-500 px-2 py-0.5 rounded">ADMIN</span>' : ''}
                                    </div>
                                    <div class="hidden md:flex space-x-4">
                                        <button onclick="Render.navigate('marketplace')" class="px-3 py-2 rounded hover:bg-gray-700 transition">
                                            <i class="fas fa-store mr-2"></i>Marktplatz
                                        </button>
                                        <button onclick="Render.navigate('purchases')" class="px-3 py-2 rounded hover:bg-gray-700 transition">
                                            <i class="fas fa-shopping-bag mr-2"></i>Meine K√§ufe
                                        </button>
                                        ${canUpload ? `<button onclick="Render.navigate('upload')" class="px-3 py-2 rounded hover:bg-gray-700 transition ${isAdmin ? 'text-green-400' : ''}"><i class="fas fa-upload mr-2"></i>Hochladen</button>` : ''}
                                        ${isAdmin ? `<button onclick="Render.navigate('admin')" class="px-3 py-2 rounded-lg hover:bg-red-600/30 transition text-red-400 bg-red-500/20 border border-red-500/50"><i class="fas fa-crown mr-2"></i>Admin Panel</button>` : ''}
                                    </div>
                                </div>
                                <div class="flex items-center space-x-4">
                                    ${settings.tokenSystemEnabled ? `
                                        <div class="flex items-center space-x-2">
                                            ${isAdmin ? `
                                                <div class="flex items-center space-x-2 px-4 py-2 rounded-lg bg-red-500/20 border border-red-500 admin-glow">
                                                    <i class="fas fa-infinity text-red-400"></i>
                                                    <span class="font-bold text-red-400">UNBEGRENZT</span>
                                                </div>
                                            ` : `
                                                <button onclick="handleClaimTokens()" class="flex items-center space-x-2 px-4 py-2 rounded-lg ${canClaim ? 'bg-yellow-500/20 border border-yellow-500 token-glow cursor-pointer hover:bg-yellow-500/30' : 'bg-gray-700'} transition">
                                                    <i class="fas fa-coins text-yellow-400"></i>
                                                    <span class="font-bold text-yellow-400">${Utils.formatTokens(user.tokens)}</span>
                                                    ${canClaim ? '<i class="fas fa-gift text-green-400 ml-2"></i>' : ''}
                                                </button>
                                                ${!canClaim ? `<span class="text-xs text-gray-400">${Utils.getTimeUntilNextClaim(user)}</span>` : ''}
                                            `}
                                        </div>
                                    ` : ''}
                                    <div class="relative" id="profileDropdown">
                                        <button onclick="toggleProfileDropdown()" class="flex items-center space-x-2 px-3 py-2 rounded hover:bg-gray-700 transition">
                                            <div class="w-8 h-8 rounded-full ${isAdmin ? 'bg-gradient-to-br from-red-400 to-yellow-500' : 'bg-gradient-to-br from-green-400 to-blue-500'} flex items-center justify-center">
                                                ${isAdmin ? '<i class="fas fa-crown text-sm"></i>' : user.username.charAt(0).toUpperCase()}
                                            </div>
                                            <span class="hidden md:block">${user.username}</span>
                                            <i class="fas fa-chevron-down text-xs text-gray-400"></i>
                                        </button>
                                        <div id="profileMenu" class="hidden absolute right-0 mt-2 w-56 bg-gray-800 rounded-lg shadow-xl border border-gray-700 z-50 overflow-hidden dropdown-enter">
                                            <div class="px-4 py-3 border-b border-gray-700 bg-gray-750">
                                                <p class="font-bold">${user.username}</p>
                                                <p class="text-sm text-gray-400">${user.email}</p>
                                                <span class="text-xs px-2 py-0.5 rounded ${isAdmin ? 'bg-red-500' : user.role === 'creator' ? 'bg-purple-500' : 'bg-blue-500'}">${user.role}</span>
                                            </div>
                                            <div class="py-1">
                                                <button onclick="Render.navigate('profile'); closeProfileDropdown();" class="w-full text-left px-4 py-2 hover:bg-gray-700 flex items-center">
                                                    <i class="fas fa-user mr-3 text-blue-400"></i>Mein Profil
                                                </button>
                                                <button onclick="Render.navigate('settings'); closeProfileDropdown();" class="w-full text-left px-4 py-2 hover:bg-gray-700 flex items-center">
                                                    <i class="fas fa-cog mr-3 text-gray-400"></i>Einstellungen
                                                </button>
                                                <button onclick="Render.navigate('purchases'); closeProfileDropdown();" class="w-full text-left px-4 py-2 hover:bg-gray-700 flex items-center">
                                                    <i class="fas fa-shopping-bag mr-3 text-green-400"></i>Meine K√§ufe
                                                </button>
                                                <button onclick="showEditProfileModal(); closeProfileDropdown();" class="w-full text-left px-4 py-2 hover:bg-gray-700 flex items-center">
                                                    <i class="fas fa-edit mr-3 text-yellow-400"></i>Profil bearbeiten
                                                </button>
                                            </div>
                                            <div class="border-t border-gray-700 py-1">
                                                <button onclick="handleLogout()" class="w-full text-left px-4 py-2 hover:bg-gray-700 flex items-center text-red-400">
                                                    <i class="fas fa-sign-out-alt mr-3"></i>Abmelden
                                                </button>
                                                ${!isAdmin ? `<button onclick="showDeleteAccountModal(); closeProfileDropdown();" class="w-full text-left px-4 py-2 hover:bg-red-500/20 flex items-center text-red-500"><i class="fas fa-trash mr-3"></i>Account l√∂schen</button>` : ''}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </nav>
                `;
            },

            authPage() {
                const app = document.getElementById('app');
                
                app.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center p-4">
                        <div class="bg-gray-800/50 backdrop-blur-sm rounded-2xl p-8 w-full max-w-md border border-gray-700 fade-in">
                            <div class="text-center mb-8">
                                <i class="fas fa-cube text-5xl text-green-500 mb-4"></i>
                                <h1 class="text-3xl font-bold">MCMarket</h1>
                                <p class="text-gray-400 mt-2">Minecraft Content Marketplace</p>
                            </div>
                            
                            <div class="flex mb-6 bg-gray-700/50 rounded-lg p-1">
                                <button id="loginTab" onclick="switchAuthTab('login')" class="flex-1 py-2 rounded-lg bg-green-600 transition">Login</button>
                                <button id="registerTab" onclick="switchAuthTab('register')" class="flex-1 py-2 rounded-lg transition">Registrieren</button>
                            </div>

                            <form id="loginForm" onsubmit="handleLogin(event)">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-1">E-Mail</label>
                                        <input type="email" id="loginEmail" required class="w-full px-4 py-3 bg-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 outline-none transition" placeholder="deine@email.de">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-1">Passwort</label>
                                        <input type="password" id="loginPassword" required class="w-full px-4 py-3 bg-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 outline-none transition" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                    </div>
                                    <button type="submit" class="w-full py-3 bg-green-600 hover:bg-green-700 rounded-lg font-bold transition">
                                        <i class="fas fa-sign-in-alt mr-2"></i>Anmelden
                                    </button>
                                </div>
                            </form>

                            <form id="registerForm" class="hidden" onsubmit="handleRegister(event)">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-1">Benutzername</label>
                                        <input type="text" id="regUsername" required class="w-full px-4 py-3 bg-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 outline-none" placeholder="Dein Username">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-1">E-Mail</label>
                                        <input type="email" id="regEmail" required class="w-full px-4 py-3 bg-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 outline-none" placeholder="deine@email.de">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-1">Passwort</label>
                                        <input type="password" id="regPassword" required minlength="8" class="w-full px-4 py-3 bg-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 outline-none" placeholder="Min. 8 Zeichen">
                                    </div>
                                    <div class="flex items-start space-x-2">
                                        <input type="checkbox" id="agbCheckbox" required class="mt-1 w-4 h-4 accent-green-500">
                                        <label for="agbCheckbox" class="text-sm text-gray-400">
                                            Ich akzeptiere die <a href="#" onclick="Legal.showAGB(); return false;" class="text-green-400 hover:underline">AGB</a> und 
                                            <a href="#" onclick="Legal.showDatenschutz(); return false;" class="text-green-400 hover:underline">Datenschutzerkl√§rung</a>
                                        </label>
                                    </div>
                                    <button type="submit" class="w-full py-3 bg-green-600 hover:bg-green-700 rounded-lg font-bold transition">
                                        <i class="fas fa-user-plus mr-2"></i>Registrieren
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
            },

            navigate(view) {
                currentView = view;
                const content = document.getElementById('content');
                if (!content) return;

                switch(view) {
                    case 'marketplace': this.marketplace(); break;
                    case 'purchases': this.purchases(); break;
                    case 'upload': this.upload(); break;
                    case 'admin': this.admin(); break;
                    case 'profile': this.profile(); break;
                    case 'settings': this.userSettings(); break;
                    case 'content-detail': this.contentDetail(); break;
                    default: this.marketplace();
                }
            },

            marketplace() {
                const user = DB.getCurrentUser();
                const isAdmin = DB.isAdmin(user);
                const allContent = DB.getContent();
                const content = isAdmin ? allContent : allContent.filter(c => c.approved && c.visibility === 'public');

                document.getElementById('content').innerHTML = `
                    <div class="fade-in">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                            <div>
                                <h1 class="text-3xl font-bold"><i class="fas fa-store mr-3 text-green-500"></i>Marktplatz</h1>
                                <p class="text-gray-400 mt-1">${content.length} Inhalte verf√ºgbar</p>
                            </div>
                            <input type="text" id="searchInput" placeholder="Suchen..." class="px-4 py-2 bg-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 outline-none" value="${filterState.search}" oninput="updateFilter('search', this.value)">
                        </div>

                        <div class="flex flex-wrap gap-4 mb-6 p-4 bg-gray-800/30 rounded-xl border border-gray-700/50">
                            <div>
                                <label class="text-xs text-gray-500 block mb-1">Kategorie</label>
                                <select onchange="updateFilter('category', this.value)" class="px-3 py-2 bg-gray-700/50 rounded-lg border border-gray-600 text-sm">
                                    <option value="all">üéÆ Alle Kategorien</option>
                                    <option value="plugin">üß© Plugins</option>
                                    <option value="mod">üì¶ Mods</option>
                                    <option value="texturepack">üé® Texturepacks</option>
                                    <option value="world">üåç Welten</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs text-gray-500 block mb-1">Preis</label>
                                <select onchange="updateFilter('priceType', this.value)" class="px-3 py-2 bg-gray-700/50 rounded-lg border border-gray-600 text-sm">
                                    <option value="all">üí∞ Alle Preise</option>
                                    <option value="free">üÜì Kostenlos</option>
                                    <option value="paid">üíé Kostenpflichtig</option>
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button onclick="filterState = { category: 'all', priceType: 'all', mcVersion: 'all', search: '' }; Render.marketplace();" class="px-3 py-2 bg-gray-700/30 hover:bg-gray-700 rounded-lg text-sm text-gray-400 hover:text-white transition">
                                    <i class="fas fa-times mr-1"></i>Reset
                                </button>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${this.filterContent(content).map(item => this.contentCard(item)).join('')}
                        </div>

                        ${this.filterContent(content).length === 0 ? `
                            <div class="text-center py-16 bg-gray-800/30 rounded-xl border border-gray-700/50">
                                <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-gray-700/50 flex items-center justify-center">
                                    <i class="fas fa-box-open text-4xl text-gray-600"></i>
                                </div>
                                <p class="text-xl font-bold mb-2">Noch keine Inhalte</p>
                                <p class="text-gray-500 mb-6">Der Marktplatz wartet auf deinen ersten Upload!</p>
                                ${isAdmin || (user.permissions && user.permissions.canUpload) ? `<button onclick="Render.navigate('upload')" class="px-6 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-bold transition"><i class="fas fa-upload mr-2"></i>Jetzt hochladen</button>` : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            },

            filterContent(content) {
                return content.filter(item => {
                    if (filterState.category !== 'all' && item.category !== filterState.category) return false;
                    if (filterState.priceType === 'free' && item.price > 0) return false;
                    if (filterState.priceType === 'paid' && item.price === 0) return false;
                    if (filterState.search && !item.title.toLowerCase().includes(filterState.search.toLowerCase())) return false;
                    return true;
                });
            },

            contentCard(item) {
                const user = DB.getCurrentUser();
                const isAdmin = DB.isAdmin(user);
                const purchased = Content.hasPurchased(item.id);
                const canAfford = isAdmin || user.tokens >= item.price;
                const image = DB.getImage(item.id);
                const categoryColors = {
                    plugin: 'from-green-600 to-emerald-800',
                    mod: 'from-blue-600 to-indigo-800',
                    texturepack: 'from-purple-600 to-pink-800',
                    world: 'from-cyan-600 to-teal-800'
                };

                return `
                    <div class="bg-gray-800/50 rounded-xl overflow-hidden card-hover border ${!item.approved ? 'border-yellow-500' : 'border-gray-700'} cursor-pointer" onclick="viewContent('${item.id}')">
                        <div class="h-40 bg-gradient-to-br ${image ? '' : categoryColors[item.category] || 'from-gray-700 to-gray-800'} flex items-center justify-center relative overflow-hidden">
                            ${image ? `<img src="${image}" class="w-full h-full object-cover" alt="${item.title}">` : `
                                <div class="text-center">
                                    <i class="fas ${Utils.getCategoryIcon(item.category)} text-5xl text-white/30 mb-2"></i>
                                </div>
                            `}
                            <div class="absolute top-3 left-3 flex items-center space-x-1 px-2 py-1 text-xs rounded-lg bg-black/50 backdrop-blur-sm">
                                <i class="fas ${Utils.getCategoryIcon(item.category)} text-xs"></i>
                                <span>${Utils.getCategoryName(item.category)}</span>
                            </div>
                            ${!item.approved ? `<span class="absolute top-3 right-3 px-2 py-1 text-xs rounded-lg bg-yellow-500/90"><i class="fas fa-clock mr-1"></i>Ausstehend</span>` :
                              item.price === 0 ? `<span class="absolute top-3 right-3 px-2 py-1 text-xs rounded-lg bg-green-500/90 font-bold">GRATIS</span>` : 
                              purchased ? `<span class="absolute top-3 right-3 px-2 py-1 text-xs rounded-lg bg-blue-500/90"><i class="fas fa-check mr-1"></i>Gekauft</span>` : ''}
                        </div>
                        <div class="p-4">
                            <h3 class="font-bold text-lg mb-1 truncate">${item.title}</h3>
                            <p class="text-gray-500 text-xs mb-3">von ${item.uploaderName}</p>
                            <p class="text-gray-400 text-sm mb-3 line-clamp-2">${item.description.substring(0, 60)}...</p>
                            <div class="flex items-center justify-between pt-2 border-t border-gray-700">
                                <div class="flex items-center space-x-3 text-xs text-gray-500">
                                    <span class="flex items-center"><i class="fas fa-download mr-1"></i>${item.downloads}</span>
                                    ${item.mcVersions && item.mcVersions.length > 0 ? `<span class="flex items-center"><i class="fas fa-gamepad mr-1"></i>${item.mcVersions[0]}</span>` : ''}
                                </div>
                                <div class="flex items-center space-x-1 font-bold text-sm ${item.price === 0 || isAdmin ? 'text-green-400' : canAfford ? 'text-yellow-400' : 'text-red-400'}">
                                    ${isAdmin ? '<i class="fas fa-infinity text-xs"></i>' : item.price === 0 ? '<i class="fas fa-gift"></i>' : `<i class="fas fa-coins text-xs"></i> ${item.price}`}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },

            contentDetail() {
                const item = DB.getContent().find(c => c.id === selectedContent);
                if (!item) { this.navigate('marketplace'); return; }

                const user = DB.getCurrentUser();
                const isAdmin = DB.isAdmin(user);
                const purchased = Content.hasPurchased(item.id);
                const canAfford = isAdmin || user.tokens >= item.price;
                const isOwner = item.uploaderId === user.id;
                const image = DB.getImage(item.id);

                document.getElementById('content').innerHTML = `
                    <div class="fade-in max-w-4xl mx-auto">
                        <button onclick="Render.navigate('marketplace')" class="mb-6 text-gray-400 hover:text-white transition">
                            <i class="fas fa-arrow-left mr-2"></i>Zur√ºck zum Marktplatz
                        </button>

                        <div class="bg-gray-800/50 rounded-2xl overflow-hidden border border-gray-700">
                            <div class="h-64 bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center relative overflow-hidden">
                                ${image ? `<img src="${image}" class="w-full h-full object-cover" alt="${item.title}">` : `<i class="fas ${Utils.getCategoryIcon(item.category)} text-8xl text-gray-600"></i>`}
                                <span class="absolute top-4 left-4 px-3 py-1 rounded-full bg-gray-900/80 text-sm">${Utils.getCategoryName(item.category)}</span>
                            </div>

                            <div class="p-8">
                                <div class="flex flex-col md:flex-row justify-between gap-6 mb-8">
                                    <div class="flex-1">
                                        <h1 class="text-3xl font-bold mb-2">${item.title}</h1>
                                        <p class="text-gray-400 mb-4">von <span class="text-green-400">${item.uploaderName}</span> ‚Ä¢ ${Utils.formatDate(item.createdAt)}</p>
                                        <div class="flex items-center gap-4 text-sm text-gray-400">
                                            <span><i class="fas fa-download mr-1"></i>${item.downloads} Downloads</span>
                                            <span><i class="fas fa-file mr-1"></i>${item.fileSize || 'N/A'}</span>
                                        </div>
                                    </div>
                                    <div class="flex flex-col items-end gap-3">
                                        <div class="text-3xl font-bold ${item.price === 0 || isAdmin ? 'text-green-400' : 'text-yellow-400'}">
                                            ${isAdmin ? '<i class="fas fa-infinity"></i> Kostenlos' : item.price === 0 ? 'Kostenlos' : `<i class="fas fa-coins"></i> ${item.price}`}
                                        </div>
                                        ${purchased || isOwner || item.price === 0 || isAdmin ? `
                                            <div class="flex flex-col gap-2">
                                                <button onclick="handleDownload('${item.id}')" class="px-8 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-bold transition flex items-center justify-center">
                                                    <i class="fas fa-download mr-2"></i>Herunterladen
                                                </button>
                                                ${isOwner || isAdmin ? `
                                                    <div class="flex gap-2">
                                                        <button onclick="showEditContentModal('${item.id}')" class="flex-1 px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-lg font-bold transition flex items-center justify-center">
                                                            <i class="fas fa-edit mr-2"></i>Bearbeiten
                                                        </button>
                                                        <button onclick="showUpdateFileModal('${item.id}')" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-bold transition flex items-center justify-center">
                                                            <i class="fas fa-sync mr-2"></i>Update
                                                        </button>
                                                    </div>
                                                ` : ''}
                                            </div>
                                        ` : canAfford ? `
                                            <button onclick="handlePurchase('${item.id}')" class="px-8 py-3 bg-yellow-600 hover:bg-yellow-700 rounded-lg font-bold transition flex items-center">
                                                <i class="fas fa-shopping-cart mr-2"></i>Kaufen f√ºr ${item.price} Tokens
                                            </button>
                                        ` : `
                                            <button disabled class="px-8 py-3 bg-gray-600 rounded-lg font-bold cursor-not-allowed flex items-center">
                                                <i class="fas fa-lock mr-2"></i>Nicht genug Tokens
                                            </button>
                                            <p class="text-red-400 text-sm">Du brauchst noch ${item.price - user.tokens} Tokens</p>
                                        `}
                                    </div>
                                </div>

                                <div class="mb-8">
                                    <h2 class="text-xl font-bold mb-3">Beschreibung</h2>
                                    <p class="text-gray-300 leading-relaxed whitespace-pre-wrap">${item.description}</p>
                                </div>

                                ${item.mcVersions && item.mcVersions.length > 0 ? `
                                    <div class="mb-8">
                                        <h2 class="text-xl font-bold mb-3">Unterst√ºtzte Versionen</h2>
                                        <div class="flex flex-wrap gap-2">
                                            ${item.mcVersions.map(v => `<span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full">${v}</span>`).join('')}
                                        </div>
                                    </div>
                                ` : ''}

                                <div class="bg-gray-700/30 rounded-lg p-4">
                                    <h3 class="font-bold mb-2">Dateidetails</h3>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                        <div><span class="text-gray-400">Dateiname</span><p>${item.fileName || 'N/A'}</p></div>
                                        <div><span class="text-gray-400">Gr√∂√üe</span><p>${item.fileSize || 'N/A'}</p></div>
                                        <div><span class="text-gray-400">Kategorie</span><p>${Utils.getCategoryName(item.category)}</p></div>
                                        <div><span class="text-gray-400">Hochgeladen</span><p>${Utils.formatDate(item.createdAt)}</p></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },

            purchases() {
                const user = DB.getCurrentUser();
                const purchases = DB.getPurchases().filter(p => p.userId === user.id);
                const content = DB.getContent();
                const categoryColors = {
                    plugin: 'from-green-600 to-emerald-800',
                    mod: 'from-blue-600 to-indigo-800',
                    texturepack: 'from-purple-600 to-pink-800',
                    world: 'from-cyan-600 to-teal-800'
                };

                document.getElementById('content').innerHTML = `
                    <div class="fade-in">
                        <h1 class="text-3xl font-bold mb-8"><i class="fas fa-shopping-bag mr-3 text-green-500"></i>Meine K√§ufe</h1>
                        
                        ${purchases.length === 0 ? `
                            <div class="text-center py-16 bg-gray-800/30 rounded-xl border border-gray-700/50">
                                <i class="fas fa-shopping-cart text-6xl text-gray-700 mb-4"></i>
                                <p class="text-xl text-gray-400 mb-2">Noch keine K√§ufe</p>
                                <p class="text-gray-500 mb-6">Entdecke tolle Inhalte im Marktplatz!</p>
                                <button onclick="Render.navigate('marketplace')" class="px-6 py-3 bg-green-600 hover:bg-green-700 rounded-lg transition font-bold">
                                    <i class="fas fa-store mr-2"></i>Zum Marktplatz
                                </button>
                            </div>
                        ` : `
                            <div class="grid gap-4">
                                ${purchases.map(p => {
                                    const item = content.find(c => c.id === p.contentId);
                                    if (!item) return '';
                                    const image = DB.getImage(item.id);
                                    return `
                                        <div class="bg-gray-800/30 rounded-xl p-4 flex items-center justify-between border border-gray-700/50 hover:border-gray-600 transition group">
                                            <div class="flex items-center space-x-4">
                                                <div class="w-16 h-16 bg-gradient-to-br ${categoryColors[item.category] || 'from-gray-700 to-gray-800'} rounded-lg flex items-center justify-center overflow-hidden">
                                                    ${image ? `<img src="${image}" class="w-full h-full object-cover" alt="${item.title}">` : `<i class="fas ${Utils.getCategoryIcon(item.category)} text-2xl text-white/50"></i>`}
                                                </div>
                                                <div>
                                                    <h3 class="font-bold group-hover:text-green-400 transition">${item.title}</h3>
                                                    <p class="text-sm text-gray-500 flex items-center">
                                                        <i class="fas ${Utils.getCategoryIcon(item.category)} mr-2 text-xs"></i>
                                                        ${Utils.getCategoryName(item.category)} 
                                                        <span class="mx-2">‚Ä¢</span>
                                                        <i class="fas fa-calendar mr-1 text-xs"></i>
                                                        ${Utils.formatDate(p.date)}
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-4">
                                                <span class="text-yellow-400 text-sm"><i class="fas fa-coins mr-1"></i>${p.price}</span>
                                                <button onclick="handleDownload('${item.id}')" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition flex items-center">
                                                    <i class="fas fa-download mr-2"></i>
                                                    <span class="hidden sm:inline">Download</span>
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        `}
                    </div>
                `;
            },

            upload() {
                const user = DB.getCurrentUser();
                const isAdmin = DB.isAdmin(user);
                const settings = DB.getSettings();

                if (!isAdmin && (!user.permissions.canUpload || !settings.uploadsEnabled)) {
                    document.getElementById('content').innerHTML = `
                        <div class="text-center py-16">
                            <i class="fas fa-lock text-5xl text-red-500 mb-4"></i>
                            <p class="text-xl">Upload-Funktion ist f√ºr dich nicht verf√ºgbar</p>
                        </div>
                    `;
                    return;
                }

                document.getElementById('content').innerHTML = `
                    <div class="fade-in max-w-2xl mx-auto">
                        <h1 class="text-3xl font-bold mb-8"><i class="fas fa-upload mr-3 text-green-500"></i>Inhalt Hochladen</h1>
                        
                        <form onsubmit="handleUpload(event)" class="bg-gray-800/50 rounded-xl p-6 border border-gray-700 space-y-6">
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Titel *</label>
                                <input type="text" id="uploadTitle" required class="w-full px-4 py-3 bg-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 outline-none" placeholder="z.B. Super Plugin Pro">
                            </div>

                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Beschreibung *</label>
                                <textarea id="uploadDesc" required rows="4" class="w-full px-4 py-3 bg-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 outline-none" placeholder="Beschreibe deinen Inhalt..."></textarea>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-400 mb-2">Kategorie *</label>
                                    <select id="uploadCategory" required class="w-full px-4 py-3 bg-gray-700 rounded-lg">
                                        <option value="plugin">üß© Plugin</option>
                                        <option value="mod">üì¶ Mod</option>
                                        <option value="texturepack">üé® Texturepack</option>
                                        <option value="world">üåç Welt</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-2">Preis (Tokens)</label>
                                    <input type="number" id="uploadPrice" min="0" value="0" class="w-full px-4 py-3 bg-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 outline-none">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Minecraft Versionen</label>
                                <div class="flex flex-wrap gap-2">
                                    ${['1.21.4', '1.21.3', '1.21.2', '1.21.1', '1.21', '1.20.6', '1.20.5', '1.20.4', '1.20.3', '1.20.2', '1.20.1', '1.20', '1.19.4', '1.19.3', '1.19.2', '1.19.1', '1.19', '1.18.2', '1.18.1', '1.18', '1.17.1', '1.17', '1.16.5', '1.16.4', '1.16.3', '1.16.2', '1.16.1', '1.15.2', '1.14.4', '1.13.2', '1.12.2', '1.12.1', '1.12', '1.11.2', '1.10.2', '1.9.4', '1.8.9', '1.8.8', '1.7.10'].map(v => `
                                        <label class="flex items-center space-x-2 px-3 py-2 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition">
                                            <input type="checkbox" name="mcVersion" value="${v}" class="accent-green-500">
                                            <span>${v}</span>
                                        </label>
                                    `).join('')}
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Vorschaubild (optional)</label>
                                <div class="border-2 border-dashed border-gray-600 rounded-lg p-4 text-center hover:border-blue-500 transition cursor-pointer" onclick="document.getElementById('imageInput').click()">
                                    <div id="imagePreview" class="hidden mb-4">
                                        <img id="previewImg" class="max-h-48 mx-auto rounded-lg" alt="Vorschau">
                                    </div>
                                    <i class="fas fa-image text-3xl text-gray-500 mb-2"></i>
                                    <p class="text-gray-400">Bild hochladen (PNG, JPG)</p>
                                    <input type="file" id="imageInput" class="hidden" accept="image/png,image/jpeg,image/gif" onchange="handleImagePreview(event)">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Datei hochladen * <span class="text-yellow-400">(Pflicht)</span></label>
                                <div class="border-2 border-dashed border-gray-600 rounded-lg p-8 text-center hover:border-green-500 transition cursor-pointer" onclick="document.getElementById('fileInput').click()">
                                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-500 mb-2"></i>
                                    <p class="text-gray-400">Klicke zum Hochladen</p>
                                    <p class="text-sm text-gray-500 mt-1">.jar, .zip, .sk, .yml, .json erlaubt (max. 5MB)</p>
                                    <input type="file" id="fileInput" class="hidden" accept=".jar,.zip,.sk,.yml,.json,.png,.mcpack,.mcworld" required>
                                </div>
                                <p id="fileName" class="mt-2 text-green-400"></p>
                            </div>

                            <button type="submit" class="w-full py-3 bg-green-600 hover:bg-green-700 rounded-lg font-bold transition">
                                <i class="fas fa-upload mr-2"></i>Hochladen
                            </button>
                        </form>
                    </div>
                `;

                document.getElementById('fileInput').addEventListener('change', (e) => {
                    if (e.target.files[0]) {
                        document.getElementById('fileName').textContent = '‚úì ' + e.target.files[0].name + ' (' + Utils.formatFileSize(e.target.files[0].size) + ')';
                    }
                });
            },

            userSettings() {
                const user = DB.getCurrentUser();
                const userSettings = user.settings || {};

                document.getElementById('content').innerHTML = `
                    <div class="fade-in max-w-2xl mx-auto">
                        <h1 class="text-3xl font-bold mb-8"><i class="fas fa-cog mr-3 text-gray-400"></i>Einstellungen</h1>
                        
                        <div class="bg-gray-800/50 rounded-xl p-6 border border-gray-700 space-y-6">
                            <div>
                                <h2 class="text-xl font-bold mb-4"><i class="fas fa-bell mr-2 text-yellow-400"></i>Benachrichtigungen</h2>
                                <div class="space-y-4">
                                    <label class="flex items-center justify-between p-4 bg-gray-700/50 rounded-lg cursor-pointer hover:bg-gray-700 transition">
                                        <span><i class="fas fa-bell mr-2"></i>Push-Benachrichtigungen</span>
                                        <input type="checkbox" id="notifToggle" ${userSettings.notifications ? 'checked' : ''} onchange="saveUserSetting('notifications', this.checked)" class="w-5 h-5 accent-green-500">
                                    </label>
                                    <label class="flex items-center justify-between p-4 bg-gray-700/50 rounded-lg cursor-pointer hover:bg-gray-700 transition">
                                        <span><i class="fas fa-envelope mr-2"></i>E-Mail Benachrichtigungen</span>
                                        <input type="checkbox" id="emailToggle" ${userSettings.emailNotifications ? 'checked' : ''} onchange="saveUserSetting('emailNotifications', this.checked)" class="w-5 h-5 accent-green-500">
                                    </label>
                                </div>
                            </div>

                            <div class="border-t border-gray-700 pt-6">
                                <h2 class="text-xl font-bold mb-4"><i class="fas fa-palette mr-2 text-purple-400"></i>Darstellung</h2>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Theme</label>
                                        <select id="themeSelect" onchange="saveUserSetting('theme', this.value)" class="w-full px-4 py-3 bg-gray-700 rounded-lg">
                                            <option value="dark" ${userSettings.theme === 'dark' ? 'selected' : ''}>Dunkel (Standard)</option>
                                            <option value="light" ${userSettings.theme === 'light' ? 'selected' : ''}>Hell (Coming Soon)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Sprache</label>
                                        <select id="langSelect" onchange="saveUserSetting('language', this.value)" class="w-full px-4 py-3 bg-gray-700 rounded-lg">
                                            <option value="de" ${userSettings.language === 'de' ? 'selected' : ''}>Deutsch</option>
                                            <option value="en" ${userSettings.language === 'en' ? 'selected' : ''}>English (Coming Soon)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="border-t border-gray-700 pt-6">
                                <h2 class="text-xl font-bold mb-4"><i class="fas fa-shield-alt mr-2 text-blue-400"></i>Sicherheit & Datenschutz</h2>
                                <div class="space-y-4">
                                    <button onclick="showChangePasswordModal()" class="w-full p-4 bg-gray-700/50 rounded-lg hover:bg-gray-700 transition text-left flex items-center justify-between">
                                        <span><i class="fas fa-key mr-2 text-yellow-400"></i>Passwort √§ndern</span>
                                        <i class="fas fa-chevron-right text-gray-400"></i>
                                    </button>
                                    <button onclick="Legal.exportUserData()" class="w-full p-4 bg-gray-700/50 rounded-lg hover:bg-gray-700 transition text-left flex items-center justify-between">
                                        <span><i class="fas fa-download mr-2 text-green-400"></i>Meine Daten exportieren (DSGVO)</span>
                                        <i class="fas fa-chevron-right text-gray-400"></i>
                                    </button>
                                    <button onclick="showDeleteAccountModal()" class="w-full p-4 bg-red-500/10 border border-red-500/50 rounded-lg hover:bg-red-500/20 transition text-left flex items-center justify-between text-red-400">
                                        <span><i class="fas fa-trash mr-2"></i>Account l√∂schen</span>
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },

            profile() {
                const user = DB.getCurrentUser();
                const isAdmin = DB.isAdmin(user);
                const transactions = DB.getTransactions().filter(t => t.userId === user.id).slice(-10).reverse();
                const userPurchases = DB.getPurchases().filter(p => p.userId === user.id);
                const userContent = DB.getContent().filter(c => c.uploaderId === user.id);

                document.getElementById('content').innerHTML = `
                    <div class="fade-in max-w-3xl mx-auto">
                        <div class="flex justify-between items-center mb-8">
                            <h1 class="text-3xl font-bold"><i class="fas fa-user mr-3 text-green-500"></i>Mein Profil</h1>
                            <button onclick="Render.navigate('settings')" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition">
                                <i class="fas fa-cog mr-2"></i>Einstellungen
                            </button>
                        </div>

                        <div class="bg-gray-800/50 rounded-xl p-6 border ${isAdmin ? 'border-red-500' : 'border-gray-700'} mb-6">
                            <div class="flex items-center space-x-4 mb-6">
                                <div class="w-20 h-20 rounded-full ${isAdmin ? 'bg-gradient-to-br from-red-400 to-yellow-500 admin-glow' : 'bg-gradient-to-br from-green-400 to-blue-500'} flex items-center justify-center text-3xl font-bold">
                                    ${isAdmin ? '<i class="fas fa-crown"></i>' : user.username.charAt(0).toUpperCase()}
                                </div>
                                <div class="flex-1">
                                    <h2 class="text-2xl font-bold">${user.username}</h2>
                                    <p class="text-gray-400">${user.email}</p>
                                    <span class="text-xs px-2 py-1 rounded ${isAdmin ? 'bg-red-500' : user.role === 'creator' ? 'bg-purple-500' : 'bg-blue-500'}">${user.role.toUpperCase()}</span>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div class="bg-gray-700/50 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold ${isAdmin ? 'text-red-400' : 'text-yellow-400'}">${isAdmin ? '‚àû' : Utils.formatTokens(user.tokens)}</div>
                                    <div class="text-xs text-gray-400">Tokens</div>
                                </div>
                                <div class="bg-gray-700/50 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-blue-400">${userPurchases.length}</div>
                                    <div class="text-xs text-gray-400">K√§ufe</div>
                                </div>
                                <div class="bg-gray-700/50 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-purple-400">${userContent.length}</div>
                                    <div class="text-xs text-gray-400">Uploads</div>
                                </div>
                                <div class="bg-gray-700/50 rounded-lg p-4 text-center">
                                    <div class="text-2xl font-bold text-green-400">${Utils.formatDate(user.createdAt)}</div>
                                    <div class="text-xs text-gray-400">Mitglied seit</div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-blue-500/10 rounded-xl p-6 border border-blue-500/50 mb-6">
                            <h3 class="font-bold mb-4 text-blue-400"><i class="fas fa-shield-alt mr-2"></i>Deine Daten (DSGVO)</h3>
                            <p class="text-gray-400 text-sm mb-4">Lade alle √ºber dich gespeicherten Daten herunter.</p>
                            <button onclick="Legal.exportUserData()" class="w-full px-4 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-bold transition">
                                <i class="fas fa-download mr-2"></i>Alle meine Daten herunterladen (JSON)
                            </button>
                        </div>

                        <div class="bg-gray-800/50 rounded-xl p-6 border border-gray-700">
                            <h3 class="font-bold mb-4"><i class="fas fa-history mr-2 text-yellow-400"></i>Letzte Transaktionen</h3>
                            ${transactions.length === 0 ? `<p class="text-gray-400 text-center py-4">Keine Transaktionen</p>` : `
                                <div class="space-y-2">
                                    ${transactions.map(t => `
                                        <div class="flex items-center justify-between p-3 bg-gray-700/50 rounded-lg">
                                            <div class="flex items-center">
                                                <i class="fas ${t.amount > 0 ? 'fa-arrow-down text-green-400' : 'fa-arrow-up text-red-400'} mr-3"></i>
                                                <span class="${t.amount > 0 ? 'text-green-400' : 'text-red-400'} font-bold">${t.amount > 0 ? '+' : ''}${t.amount}</span>
                                                <span class="text-gray-400 ml-2">${t.description}</span>
                                            </div>
                                            <span class="text-sm text-gray-500">${Utils.formatDate(t.date)}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            `}
                        </div>
                    </div>
                `;
            },

            admin() {
                const user = DB.getCurrentUser();
                if (!DB.isAdmin(user)) {
                    document.getElementById('content').innerHTML = `<div class="text-center py-16"><i class="fas fa-shield-alt text-5xl text-red-500 mb-4"></i><p class="text-xl">Zugriff verweigert</p></div>`;
                    return;
                }

                const settings = DB.getSettings();
                const users = DB.getUsers();
                const content = DB.getContent();
                const pendingContent = content.filter(c => !c.approved).length;

                document.getElementById('content').innerHTML = `
                    <div class="fade-in">
                        <div class="flex items-center justify-between mb-8">
                            <h1 class="text-3xl font-bold"><i class="fas fa-crown mr-3 text-red-500"></i>Admin Panel</h1>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                            <div class="bg-gray-800/50 rounded-xl p-4 border border-gray-700">
                                <div class="text-3xl font-bold text-blue-400">${users.length}</div>
                                <div class="text-gray-400">Benutzer</div>
                            </div>
                            <div class="bg-gray-800/50 rounded-xl p-4 border border-gray-700">
                                <div class="text-3xl font-bold text-green-400">${content.length}</div>
                                <div class="text-gray-400">Inhalte</div>
                            </div>
                            <div class="bg-gray-800/50 rounded-xl p-4 border border-gray-700">
                                <div class="text-3xl font-bold text-yellow-400">${pendingContent}</div>
                                <div class="text-gray-400">Ausstehend</div>
                            </div>
                            <div class="bg-gray-800/50 rounded-xl p-4 border border-gray-700">
                                <div class="text-3xl font-bold text-purple-400">${DB.getPurchases().length}</div>
                                <div class="text-gray-400">K√§ufe</div>
                            </div>
                        </div>

                        <div class="flex flex-wrap gap-2 mb-6">
                            <button onclick="showAdminTab('settings')" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600"><i class="fas fa-cog mr-2"></i>Einstellungen</button>
                            <button onclick="showAdminTab('users')" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600"><i class="fas fa-users mr-2"></i>Benutzer</button>
                            <button onclick="showAdminTab('content')" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600"><i class="fas fa-box mr-2"></i>Inhalte</button>
                            <button onclick="showAdminTab('tokens')" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600"><i class="fas fa-coins mr-2"></i>Tokens</button>
                        </div>

                        <div id="adminContent"></div>
                    </div>
                `;
                showAdminTab('settings');
            },

            footer() {
                return `
                    <footer class="bg-gray-900/95 border-t border-gray-800 mt-16">
                        <div class="container mx-auto px-4 py-10">
                            <!-- Main Footer Content -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-8 mb-8">
                                <!-- Brand -->
                                <div class="col-span-2 md:col-span-1">
                                    <div class="flex items-center space-x-2 mb-3">
                                        <i class="fas fa-cube text-xl text-green-500"></i>
                                        <span class="text-lg font-bold">MCMarket</span>
                                    </div>
                                    <p class="text-gray-500 text-xs mb-4 leading-relaxed">
                                        Deine Plattform f√ºr Minecraft Content.
                                    </p>
                                    <div class="flex space-x-2">
                                    </div>
                                </div>
                                
                                <!-- Navigation -->
                                <div>
                                    <h4 class="text-white text-sm font-semibold mb-3">Navigation</h4>
                                    <ul class="space-y-2">
                                        <li><a href="#" onclick="Render.navigate('marketplace'); return false;" class="text-gray-500 hover:text-white text-xs transition-colors">Marktplatz</a></li>
                                        <li><a href="#" onclick="Render.navigate('purchases'); return false;" class="text-gray-500 hover:text-white text-xs transition-colors">Meine K√§ufe</a></li>
                                        <li><a href="#" onclick="Render.navigate('profile'); return false;" class="text-gray-500 hover:text-white text-xs transition-colors">Profil</a></li>
                                    </ul>
                                </div>
                                
                                <!-- Kategorien -->
                                <div>
                                    <h4 class="text-white text-sm font-semibold mb-3">Kategorien</h4>
                                    <ul class="space-y-2">
                                        <li><a href="#" onclick="filterState.category='plugin'; Render.navigate('marketplace'); return false;" class="text-gray-500 hover:text-white text-xs transition-colors flex items-center"><i class="fas fa-puzzle-piece w-4 text-green-500 mr-2"></i>Plugins</a></li>
                                        <li><a href="#" onclick="filterState.category='mod'; Render.navigate('marketplace'); return false;" class="text-gray-500 hover:text-white text-xs transition-colors flex items-center"><i class="fas fa-cube w-4 text-blue-500 mr-2"></i>Mods</a></li>
                                        <li><a href="#" onclick="filterState.category='texturepack'; Render.navigate('marketplace'); return false;" class="text-gray-500 hover:text-white text-xs transition-colors flex items-center"><i class="fas fa-image w-4 text-purple-500 mr-2"></i>Texturepacks</a></li>
                                        <li><a href="#" onclick="filterState.category='world'; Render.navigate('marketplace'); return false;" class="text-gray-500 hover:text-white text-xs transition-colors flex items-center"><i class="fas fa-globe w-4 text-cyan-500 mr-2"></i>Welten</a></li>
                                    </ul>
                                </div>
                                
                                <!-- Rechtliches -->
                                <div>
                                    <h4 class="text-white text-sm font-semibold mb-3">Rechtliches</h4>
                                    <ul class="space-y-2">
                                        <li><a href="#" onclick="Legal.showImpressum(); return false;" class="text-gray-500 hover:text-white text-xs transition-colors">Impressum</a></li>
                                        <li><a href="#" onclick="Legal.showDatenschutz(); return false;" class="text-gray-500 hover:text-white text-xs transition-colors">Datenschutz</a></li>
                                        <li><a href="#" onclick="Legal.showAGB(); return false;" class="text-gray-500 hover:text-white text-xs transition-colors">AGB</a></li>
                                        <li><a href="#" onclick="Legal.showKontakt(); return false;" class="text-gray-500 hover:text-white text-xs transition-colors">Kontakt</a></li>
                                        <li><a href="#" onclick="Legal.showFAQ(); return false;" class="text-gray-500 hover:text-white text-xs transition-colors">FAQ</a></li>
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- Bottom Bar -->
                            <div class="border-t border-gray-800 pt-6 flex flex-col md:flex-row justify-between items-center gap-3">
                                <p class="text-xs text-gray-600">
                                    ¬© ${new Date().getFullYear()} MCMarket. Alle Rechte vorbehalten.
                                </p>
                                <div class="flex items-center gap-4 text-xs text-gray-600">
                                    <span class="flex items-center"><i class="fas fa-lock text-green-600 mr-1"></i>SSL</span>
                                    <span class="flex items-center"><i class="fas fa-shield-alt text-blue-600 mr-1"></i>DSGVO</span>
                                </div>
                            </div>
                        </div>
                    </footer>
                `;
            }
        };

        // ============ ADMIN TAB FUNCTIONS ============
        function showAdminTab(tab) {
            const adminContent = document.getElementById('adminContent');
            const settings = DB.getSettings();
            const users = DB.getUsers();
            const content = DB.getContent();

            switch(tab) {
                case 'settings':
                    adminContent.innerHTML = `
                        <div class="bg-gray-800/50 rounded-xl p-6 border border-gray-700 space-y-6">
                            <h2 class="text-xl font-bold"><i class="fas fa-cog mr-2"></i>Globale Einstellungen</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <label class="flex items-center justify-between p-4 bg-gray-700/50 rounded-lg cursor-pointer">
                                    <span><i class="fas fa-upload mr-2 text-green-400"></i>Uploads aktiv</span>
                                    <input type="checkbox" ${settings.uploadsEnabled ? 'checked' : ''} onchange="adminUpdateSetting('uploadsEnabled', this.checked)" class="w-5 h-5 accent-green-500">
                                </label>
                                <label class="flex items-center justify-between p-4 bg-gray-700/50 rounded-lg cursor-pointer">
                                    <span><i class="fas fa-shopping-cart mr-2 text-blue-400"></i>Verk√§ufe aktiv</span>
                                    <input type="checkbox" ${settings.salesEnabled ? 'checked' : ''} onchange="adminUpdateSetting('salesEnabled', this.checked)" class="w-5 h-5 accent-green-500">
                                </label>
                                <label class="flex items-center justify-between p-4 bg-gray-700/50 rounded-lg cursor-pointer">
                                    <span><i class="fas fa-coins mr-2 text-yellow-400"></i>Token-System</span>
                                    <input type="checkbox" ${settings.tokenSystemEnabled ? 'checked' : ''} onchange="adminUpdateSetting('tokenSystemEnabled', this.checked)" class="w-5 h-5 accent-green-500">
                                </label>
                                <label class="flex items-center justify-between p-4 bg-gray-700/50 rounded-lg cursor-pointer">
                                    <span><i class="fas fa-user-plus mr-2 text-cyan-400"></i>Registrierung</span>
                                    <input type="checkbox" ${settings.registrationEnabled ? 'checked' : ''} onchange="adminUpdateSetting('registrationEnabled', this.checked)" class="w-5 h-5 accent-green-500">
                                </label>
                                <label class="flex items-center justify-between p-4 bg-gray-700/50 rounded-lg cursor-pointer">
                                    <span><i class="fas fa-check mr-2 text-purple-400"></i>Genehmigung n√∂tig</span>
                                    <input type="checkbox" ${settings.requireApproval ? 'checked' : ''} onchange="adminUpdateSetting('requireApproval', this.checked)" class="w-5 h-5 accent-green-500">
                                </label>
                                <label class="flex items-center justify-between p-4 bg-red-500/20 border border-red-500 rounded-lg cursor-pointer">
                                    <span><i class="fas fa-tools mr-2 text-red-400"></i>Wartungsmodus</span>
                                    <input type="checkbox" ${settings.maintenanceMode ? 'checked' : ''} onchange="adminUpdateSetting('maintenanceMode', this.checked)" class="w-5 h-5 accent-red-500">
                                </label>
                            </div>
                            <div class="border-t border-gray-700 pt-6">
                                <h3 class="font-bold mb-4"><i class="fas fa-coins mr-2 text-yellow-400"></i>Token-Einstellungen</h3>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Intervall</label>
                                        <select onchange="adminUpdateSetting('tokenInterval', this.value)" class="w-full px-4 py-3 bg-gray-700 rounded-lg">
                                            <option value="hourly" ${settings.tokenInterval === 'hourly' ? 'selected' : ''}>St√ºndlich</option>
                                            <option value="daily" ${settings.tokenInterval === 'daily' ? 'selected' : ''}>T√§glich</option>
                                            <option value="weekly" ${settings.tokenInterval === 'weekly' ? 'selected' : ''}>W√∂chentlich</option>
                                            <option value="monthly" ${settings.tokenInterval === 'monthly' ? 'selected' : ''}>Monatlich</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Tokens pro Intervall</label>
                                        <input type="number" value="${settings.tokenAmount}" min="1" onchange="adminUpdateSetting('tokenAmount', parseInt(this.value))" class="w-full px-4 py-3 bg-gray-700 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Willkommens-Tokens</label>
                                        <input type="number" value="${settings.welcomeTokens || 50}" min="0" onchange="adminUpdateSetting('welcomeTokens', parseInt(this.value))" class="w-full px-4 py-3 bg-gray-700 rounded-lg">
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;

                case 'users':
                    adminContent.innerHTML = `
                        <div class="bg-gray-800/50 rounded-xl border border-gray-700 overflow-hidden">
                            <div class="p-4 bg-gray-700/50 border-b border-gray-700"><h3 class="font-bold"><i class="fas fa-users mr-2"></i>Benutzer (${users.length})</h3></div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-700">
                                        <tr>
                                            <th class="text-left p-4">Benutzer</th>
                                            <th class="text-left p-4">Rolle</th>
                                            <th class="text-left p-4">Tokens</th>
                                            <th class="text-left p-4">Aktionen</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${users.map(u => `
                                            <tr class="border-t border-gray-700 hover:bg-gray-700/50">
                                                <td class="p-4">
                                                    <div class="font-bold">${u.username} ${u.isMainAdmin ? '<span class="text-xs text-red-400">(SUPER)</span>' : ''}</div>
                                                    <div class="text-sm text-gray-400">${u.email}</div>
                                                </td>
                                                <td class="p-4">
                                                    <select onchange="adminSetUserRole('${u.id}', this.value)" class="px-3 py-1 bg-gray-600 rounded" ${u.isMainAdmin ? 'disabled' : ''}>
                                                        <option value="user" ${u.role === 'user' ? 'selected' : ''}>User</option>
                                                        <option value="creator" ${u.role === 'creator' ? 'selected' : ''}>Creator</option>
                                                        <option value="admin" ${u.role === 'admin' ? 'selected' : ''}>Admin</option>
                                                    </select>
                                                </td>
                                                <td class="p-4">
                                                    ${u.isMainAdmin ? '<span class="text-red-400 font-bold">‚àû</span>' : `
                                                        <div class="flex items-center space-x-2">
                                                            <input type="number" value="${u.tokens}" id="tokens-${u.id}" class="w-24 px-2 py-1 bg-gray-600 rounded" min="0">
                                                            <button onclick="adminSetUserTokens('${u.id}')" class="px-2 py-1 bg-green-600 rounded hover:bg-green-700"><i class="fas fa-save"></i></button>
                                                        </div>
                                                    `}
                                                </td>
                                                <td class="p-4">
                                                    ${u.isMainAdmin ? '' : `<button onclick="adminDeleteUser('${u.id}')" class="px-3 py-1 bg-red-600 rounded hover:bg-red-700"><i class="fas fa-trash"></i></button>`}
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                    break;

                case 'content':
                    adminContent.innerHTML = `
                        <div class="bg-gray-800/50 rounded-xl border border-gray-700 overflow-hidden">
                            <div class="p-4 bg-gray-700/50 border-b border-gray-700"><h3 class="font-bold"><i class="fas fa-box mr-2"></i>Inhalte (${content.length})</h3></div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-700">
                                        <tr>
                                            <th class="text-left p-4">Titel</th>
                                            <th class="text-left p-4">Uploader</th>
                                            <th class="text-left p-4">Preis</th>
                                            <th class="text-left p-4">Status</th>
                                            <th class="text-left p-4">Aktionen</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${content.map(c => `
                                            <tr class="border-t border-gray-700 hover:bg-gray-700/50 ${!c.approved ? 'bg-yellow-500/10' : ''}">
                                                <td class="p-4 font-bold">${c.title}</td>
                                                <td class="p-4 text-gray-400">${c.uploaderName}</td>
                                                <td class="p-4">
                                                    <div class="flex items-center space-x-2">
                                                        <input type="number" value="${c.price}" id="price-${c.id}" class="w-20 px-2 py-1 bg-gray-600 rounded" min="0">
                                                        <button onclick="adminUpdateContentPrice('${c.id}')" class="px-2 py-1 bg-green-600 rounded"><i class="fas fa-save"></i></button>
                                                    </div>
                                                </td>
                                                <td class="p-4"><span class="px-2 py-1 rounded text-xs ${c.approved ? 'bg-green-600' : 'bg-yellow-600'}">${c.approved ? 'OK' : 'Ausstehend'}</span></td>
                                                <td class="p-4">
                                                    <div class="flex space-x-2">
                                                        ${!c.approved ? `<button onclick="adminApproveContent('${c.id}')" class="px-3 py-1 bg-green-600 rounded"><i class="fas fa-check"></i></button>` : ''}
                                                        <button onclick="adminDeleteContent('${c.id}')" class="px-3 py-1 bg-red-600 rounded"><i class="fas fa-trash"></i></button>
                                                    </div>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                    break;

                case 'tokens':
                    const nonAdminUsers = users.filter(u => !u.isMainAdmin);
                    adminContent.innerHTML = `
                        <div class="bg-gray-800/50 rounded-xl p-6 border border-gray-700">
                            <h3 class="font-bold mb-4"><i class="fas fa-gift text-yellow-400 mr-2"></i>Tokens vergeben</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-400 mb-2">Benutzer</label>
                                    <select id="giveTokensUser" class="w-full px-4 py-3 bg-gray-700 rounded-lg">
                                        ${nonAdminUsers.map(u => `<option value="${u.id}">${u.username} (${u.tokens})</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-2">Anzahl</label>
                                    <input type="number" id="giveTokensAmount" value="100" min="1" class="w-full px-4 py-3 bg-gray-700 rounded-lg">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2 mt-4">
                                <button onclick="adminGiveTokens()" class="py-3 bg-green-600 hover:bg-green-700 rounded-lg font-bold"><i class="fas fa-plus mr-2"></i>Hinzuf√ºgen</button>
                                <button onclick="adminTakeTokens()" class="py-3 bg-red-600 hover:bg-red-700 rounded-lg font-bold"><i class="fas fa-minus mr-2"></i>Abziehen</button>
                            </div>
                        </div>
                    `;
                    break;
            }
        }

        // ============ HELPER FUNCTIONS ============
        function toggleProfileDropdown() {
            document.getElementById('profileMenu').classList.toggle('hidden');
        }

        function closeProfileDropdown() {
            const menu = document.getElementById('profileMenu');
            if (menu) menu.classList.add('hidden');
        }

        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('profileDropdown');
            if (dropdown && !dropdown.contains(e.target)) closeProfileDropdown();
        });

        function showModal(content) {
            const modal = document.createElement('div');
            modal.id = 'modal-overlay';
            modal.className = 'fixed inset-0 modal-overlay flex items-center justify-center z-50 fade-in';
            modal.innerHTML = `<div class="bg-gray-800 rounded-xl border border-gray-700 p-6 max-w-md w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">${content}</div>`;
            modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
            document.body.appendChild(modal);
        }

        function closeModal() {
            const modal = document.getElementById('modal-overlay');
            if (modal) modal.remove();
        }

        function handleImagePreview(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    uploadedImagePreview = event.target.result;
                    document.getElementById('imagePreview').classList.remove('hidden');
                    document.getElementById('previewImg').src = uploadedImagePreview;
                };
                reader.readAsDataURL(file);
            }
        }

        function saveUserSetting(key, value) {
            const user = DB.getCurrentUser();
            if (DB.updateUserSettings(user.id, { [key]: value })) {
                Utils.showToast('Einstellung gespeichert');
            }
        }

        function showEditProfileModal() {
            const user = DB.getCurrentUser();
            showModal(`
                <h2 class="text-xl font-bold mb-4"><i class="fas fa-edit mr-2 text-yellow-400"></i>Profil bearbeiten</h2>
                <form onsubmit="handleEditProfile(event)">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Benutzername</label>
                            <input type="text" id="editUsername" value="${user.username}" required class="w-full px-4 py-3 bg-gray-700 rounded-lg outline-none">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">E-Mail</label>
                            <input type="email" id="editEmail" value="${user.email}" required class="w-full px-4 py-3 bg-gray-700 rounded-lg outline-none" ${user.isMainAdmin ? 'disabled' : ''}>
                        </div>
                        <div class="flex gap-3">
                            <button type="button" onclick="closeModal()" class="flex-1 py-3 bg-gray-600 rounded-lg font-bold">Abbrechen</button>
                            <button type="submit" class="flex-1 py-3 bg-green-600 rounded-lg font-bold">Speichern</button>
                        </div>
                    </div>
                </form>
            `);
        }

        function handleEditProfile(e) {
            e.preventDefault();
            const user = DB.getCurrentUser();
            const users = DB.getUsers();
            const idx = users.findIndex(u => u.id === user.id);
            users[idx].username = document.getElementById('editUsername').value;
            if (!user.isMainAdmin) users[idx].email = document.getElementById('editEmail').value;
            DB.setUsers(users);
            closeModal();
            Utils.showToast('Profil aktualisiert');
            Render.app();
        }

        function showChangePasswordModal() {
            showModal(`
                <h2 class="text-xl font-bold mb-4"><i class="fas fa-key mr-2 text-purple-400"></i>Passwort √§ndern</h2>
                <form onsubmit="handleChangePassword(event)">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Aktuelles Passwort</label>
                            <input type="password" id="currentPassword" required class="w-full px-4 py-3 bg-gray-700 rounded-lg outline-none">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Neues Passwort</label>
                            <input type="password" id="newPassword" required minlength="6" class="w-full px-4 py-3 bg-gray-700 rounded-lg outline-none">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Passwort best√§tigen</label>
                            <input type="password" id="confirmPassword" required class="w-full px-4 py-3 bg-gray-700 rounded-lg outline-none">
                        </div>
                        <div class="flex gap-3">
                            <button type="button" onclick="closeModal()" class="flex-1 py-3 bg-gray-600 rounded-lg font-bold">Abbrechen</button>
                            <button type="submit" class="flex-1 py-3 bg-purple-600 rounded-lg font-bold">√Ñndern</button>
                        </div>
                    </div>
                </form>
            `);
        }

        function handleChangePassword(e) {
            e.preventDefault();
            const user = DB.getCurrentUser();
            if (document.getElementById('currentPassword').value !== user.password) {
                Utils.showToast('Aktuelles Passwort falsch', 'error');
                return;
            }
            if (document.getElementById('newPassword').value !== document.getElementById('confirmPassword').value) {
                Utils.showToast('Passw√∂rter stimmen nicht √ºberein', 'error');
                return;
            }
            const users = DB.getUsers();
            const idx = users.findIndex(u => u.id === user.id);
            users[idx].password = document.getElementById('newPassword').value;
            DB.setUsers(users);
            closeModal();
            Utils.showToast('Passwort ge√§ndert');
        }

        function showEditContentModal(contentId) {
            const content = DB.getContent().find(c => c.id === contentId);
            if (!content) return;
            
            const mcVersions = ['1.21.4', '1.21.3', '1.21.2', '1.21.1', '1.21', '1.20.6', '1.20.5', '1.20.4', '1.20.3', '1.20.2', '1.20.1', '1.20', '1.19.4', '1.19.3', '1.19.2', '1.19.1', '1.19', '1.18.2', '1.18.1', '1.18', '1.17.1', '1.17', '1.16.5', '1.16.4', '1.16.3', '1.16.2', '1.16.1', '1.15.2', '1.14.4', '1.13.2', '1.12.2', '1.12.1', '1.12', '1.11.2', '1.10.2', '1.9.4', '1.8.9', '1.8.8', '1.7.10'];
            
            showModal(`
                <h2 class="text-xl font-bold mb-4"><i class="fas fa-edit mr-2 text-yellow-400"></i>Inhalt bearbeiten</h2>
                <form onsubmit="handleEditContent(event, '${contentId}')">
                    <div class="space-y-4 max-h-96 overflow-y-auto pr-2">
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Titel</label>
                            <input type="text" id="editContentTitle" value="${content.title}" required class="w-full px-4 py-3 bg-gray-700 rounded-lg outline-none">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Beschreibung</label>
                            <textarea id="editContentDesc" rows="4" required class="w-full px-4 py-3 bg-gray-700 rounded-lg outline-none">${content.description}</textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">Kategorie</label>
                                <select id="editContentCategory" class="w-full px-4 py-3 bg-gray-700 rounded-lg">
                                    <option value="plugin" ${content.category === 'plugin' ? 'selected' : ''}>Plugin</option>
                                    <option value="mod" ${content.category === 'mod' ? 'selected' : ''}>Mod</option>
                                    <option value="texturepack" ${content.category === 'texturepack' ? 'selected' : ''}>Texturepack</option>
                                    <option value="world" ${content.category === 'world' ? 'selected' : ''}>Welt</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">Preis (Tokens)</label>
                                <input type="number" id="editContentPrice" value="${content.price}" min="0" class="w-full px-4 py-3 bg-gray-700 rounded-lg outline-none">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Sichtbarkeit</label>
                            <select id="editContentVisibility" class="w-full px-4 py-3 bg-gray-700 rounded-lg">
                                <option value="public" ${content.visibility === 'public' ? 'selected' : ''}>√ñffentlich</option>
                                <option value="private" ${content.visibility === 'private' ? 'selected' : ''}>Privat</option>
                                <option value="purchased" ${content.visibility === 'purchased' ? 'selected' : ''}>Nur K√§ufer</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Minecraft Versionen</label>
                            <div class="flex flex-wrap gap-2 max-h-32 overflow-y-auto p-2 bg-gray-700/50 rounded-lg">
                                ${mcVersions.map(v => `
                                    <label class="flex items-center space-x-1 px-2 py-1 bg-gray-600 rounded cursor-pointer hover:bg-gray-500 transition text-sm">
                                        <input type="checkbox" name="editMcVersion" value="${v}" ${content.mcVersions && content.mcVersions.includes(v) ? 'checked' : ''} class="accent-green-500">
                                        <span>${v}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    <div class="flex gap-3 mt-4">
                        <button type="button" onclick="closeModal()" class="flex-1 py-3 bg-gray-600 rounded-lg font-bold">Abbrechen</button>
                        <button type="submit" class="flex-1 py-3 bg-yellow-600 hover:bg-yellow-700 rounded-lg font-bold">Speichern</button>
                    </div>
                </form>
            `);
        }

        function handleEditContent(e, contentId) {
            e.preventDefault();
            const allContent = DB.getContent();
            const idx = allContent.findIndex(c => c.id === contentId);
            if (idx === -1) return;

            const mcVersions = Array.from(document.querySelectorAll('input[name="editMcVersion"]:checked')).map(c => c.value);

            allContent[idx].title = document.getElementById('editContentTitle').value.trim();
            allContent[idx].description = document.getElementById('editContentDesc').value.trim();
            allContent[idx].category = document.getElementById('editContentCategory').value;
            allContent[idx].price = parseInt(document.getElementById('editContentPrice').value) || 0;
            allContent[idx].visibility = document.getElementById('editContentVisibility').value;
            allContent[idx].mcVersions = mcVersions;
            allContent[idx].updatedAt = new Date().toISOString();

            DB.setContent(allContent);
            closeModal();
            Utils.showToast('Inhalt aktualisiert!');
            Render.navigate('content-detail');
        }

        function showUpdateFileModal(contentId) {
            const content = DB.getContent().find(c => c.id === contentId);
            if (!content) return;

            showModal(`
                <h2 class="text-xl font-bold mb-4"><i class="fas fa-sync mr-2 text-blue-400"></i>Datei aktualisieren</h2>
                <p class="text-gray-400 mb-4">Lade eine neue Version deiner Datei hoch. Die alte Datei wird ersetzt.</p>
                <div class="bg-gray-700/50 rounded-lg p-4 mb-4">
                    <p class="text-sm"><strong>Aktuell:</strong> ${content.fileName || 'Keine Datei'}</p>
                    <p class="text-sm text-gray-400">Gr√∂√üe: ${content.fileSize || 'N/A'}</p>
                </div>
                <form onsubmit="handleUpdateFile(event, '${contentId}')">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Neue Datei ausw√§hlen</label>
                            <div class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center hover:border-blue-500 transition cursor-pointer" onclick="document.getElementById('updateFileInput').click()">
                                <i class="fas fa-cloud-upload-alt text-3xl text-gray-500 mb-2"></i>
                                <p class="text-gray-400">Klicke zum Hochladen</p>
                                <p class="text-sm text-gray-500 mt-1">.jar, .zip, .mcpack, .mcworld erlaubt</p>
                                <input type="file" id="updateFileInput" class="hidden" accept=".jar,.zip,.mcpack,.mcworld,.png" required>
                            </div>
                            <p id="updateFileName" class="mt-2 text-blue-400"></p>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Versions-Notiz (optional)</label>
                            <input type="text" id="updateVersionNote" placeholder="z.B. v1.2 - Bugfixes" class="w-full px-4 py-3 bg-gray-700 rounded-lg outline-none">
                        </div>
                    </div>
                    <div class="flex gap-3 mt-4">
                        <button type="button" onclick="closeModal()" class="flex-1 py-3 bg-gray-600 rounded-lg font-bold">Abbrechen</button>
                        <button type="submit" class="flex-1 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-bold">Hochladen</button>
                    </div>
                </form>
            `);

            setTimeout(() => {
                document.getElementById('updateFileInput').addEventListener('change', (e) => {
                    if (e.target.files[0]) {
                        document.getElementById('updateFileName').textContent = '‚úì ' + e.target.files[0].name + ' (' + Utils.formatFileSize(e.target.files[0].size) + ')';
                    }
                });
            }, 100);
        }

        function handleUpdateFile(e, contentId) {
            e.preventDefault();
            const file = document.getElementById('updateFileInput').files[0];
            const versionNote = document.getElementById('updateVersionNote').value.trim();

            if (!file) {
                Utils.showToast('Bitte Datei ausw√§hlen', 'error');
                return;
            }

            if (file.size > 5 * 1024 * 1024) {
                Utils.showToast('Datei zu gro√ü (max 5MB)', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(event) {
                const base64Data = event.target.result.split(',')[1];
                
                // Datei speichern
                DB.saveFile(contentId, { 
                    data: base64Data, 
                    type: file.type, 
                    name: file.name, 
                    size: file.size 
                });

                // Content aktualisieren
                const allContent = DB.getContent();
                const idx = allContent.findIndex(c => c.id === contentId);
                if (idx !== -1) {
                    allContent[idx].fileName = file.name;
                    allContent[idx].fileSize = Utils.formatFileSize(file.size);
                    allContent[idx].updatedAt = new Date().toISOString();
                    if (versionNote) {
                        allContent[idx].versionNote = versionNote;
                    }
                    DB.setContent(allContent);
                }

                closeModal();
                Utils.showToast('Datei aktualisiert!');
                Render.navigate('content-detail');
            };

            reader.onerror = function() {
                Utils.showToast('Fehler beim Lesen der Datei', 'error');
            };

            reader.readAsDataURL(file);
        }

        function showDeleteAccountModal() {
            const user = DB.getCurrentUser();
            if (user.isMainAdmin) { Utils.showToast('Admin-Account kann nicht gel√∂scht werden', 'error'); return; }
            showModal(`
                <h2 class="text-xl font-bold mb-4 text-red-500"><i class="fas fa-exclamation-triangle mr-2"></i>Account l√∂schen</h2>
                <div class="bg-red-500/20 border border-red-500 rounded-lg p-4 mb-4">
                    <p class="text-red-300"><strong>Warnung!</strong> Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.</p>
                </div>
                <form onsubmit="handleDeleteAccount(event)">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Passwort zur Best√§tigung</label>
                            <input type="password" id="deleteConfirmPassword" required class="w-full px-4 py-3 bg-gray-700 rounded-lg outline-none">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Tippe "L√ñSCHEN"</label>
                            <input type="text" id="deleteConfirmText" required class="w-full px-4 py-3 bg-gray-700 rounded-lg outline-none">
                        </div>
                        <div class="flex gap-3">
                            <button type="button" onclick="closeModal()" class="flex-1 py-3 bg-gray-600 rounded-lg font-bold">Abbrechen</button>
                            <button type="submit" class="flex-1 py-3 bg-red-600 rounded-lg font-bold">L√∂schen</button>
                        </div>
                    </div>
                </form>
            `);
        }

        function handleDeleteAccount(e) {
            e.preventDefault();
            const user = DB.getCurrentUser();
            if (document.getElementById('deleteConfirmPassword').value !== user.password) {
                Utils.showToast('Falsches Passwort', 'error');
                return;
            }
            if (document.getElementById('deleteConfirmText').value !== 'L√ñSCHEN') {
                Utils.showToast('Bitte "L√ñSCHEN" eingeben', 'error');
                return;
            }
            DB.setUsers(DB.getUsers().filter(u => u.id !== user.id));
            DB.setPurchases(DB.getPurchases().filter(p => p.userId !== user.id));
            DB.setContent(DB.getContent().filter(c => c.uploaderId !== user.id));
            DB.logout();
            closeModal();
            currentView = 'login';
            Render.app();
            Utils.showToast('Account gel√∂scht', 'info');
        }

        // ============ EVENT HANDLERS ============
        function switchAuthTab(tab) {
            document.getElementById('loginTab').classList.toggle('bg-green-600', tab === 'login');
            document.getElementById('registerTab').classList.toggle('bg-green-600', tab === 'register');
            document.getElementById('loginForm').classList.toggle('hidden', tab !== 'login');
            document.getElementById('registerForm').classList.toggle('hidden', tab !== 'register');
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;
            const user = Auth.login(email, password);
            if (user) {
                Utils.showToast(`Willkommen, ${user.username}!`);
                currentView = 'marketplace';
                Render.app();
            } else {
                Utils.showToast('Ung√ºltige Anmeldedaten', 'error');
            }
        }

        function handleRegister(e) {
            e.preventDefault();
            const username = document.getElementById('regUsername').value.trim();
            const email = document.getElementById('regEmail').value.trim().toLowerCase();
            const password = document.getElementById('regPassword').value;
            if (!document.getElementById('agbCheckbox').checked) {
                Utils.showToast('Bitte AGB akzeptieren', 'error');
                return;
            }
            const result = Auth.register(username, email, password);
            if (result.success) {
                Utils.showToast('Willkommen! +' + DB.getSettings().welcomeTokens + ' Tokens');
                currentView = 'marketplace';
                Render.app();
            } else {
                Utils.showToast(result.error, 'error');
            }
        }

        function handleLogout() {
            DB.logout();
            currentView = 'login';
            Render.app();
            Utils.showToast('Abgemeldet', 'info');
        }

        function handleClaimTokens() {
            if (Auth.claimTokens()) {
                Utils.showToast(`+${DB.getSettings().tokenAmount} Tokens!`);
                Render.app();
            } else {
                Utils.showToast('Tokens noch nicht verf√ºgbar', 'error');
            }
        }

        function updateFilter(key, value) {
            filterState[key] = value;
            Render.marketplace();
        }

        function viewContent(id) {
            selectedContent = id;
            Render.navigate('content-detail');
        }

        function handlePurchase(id) {
            const result = Content.purchase(id);
            if (result === true) {
                Utils.showToast('Erfolgreich gekauft!');
                Render.app();
                Render.navigate('content-detail');
            } else if (result === 'already') {
                Utils.showToast('Bereits gekauft', 'info');
            } else {
                Utils.showToast('Kauf fehlgeschlagen', 'error');
            }
        }

        function handleDownload(id) {
            const user = DB.getCurrentUser();
            const item = DB.getContent().find(c => c.id === id);
            if (!user || !item) { Utils.showToast('Fehler', 'error'); return; }

            const isAdmin = DB.isAdmin(user);
            const isOwner = item.uploaderId === user.id;
            const hasPurchased = Content.hasPurchased(item.id);
            const isFree = item.price === 0;

            if (item.price > 0 && !isAdmin && !isOwner && !hasPurchased) {
                Utils.showToast('Zugriff verweigert! Erst kaufen.', 'error');
                return;
            }

            const allContent = DB.getContent();
            const contentIdx = allContent.findIndex(c => c.id === id);
            if (contentIdx !== -1) {
                allContent[contentIdx].downloads++;
                DB.setContent(allContent);
            }

            const savedFile = DB.getFile(id);
            if (savedFile && savedFile.data) {
                try {
                    const byteCharacters = atob(savedFile.data);
                    const byteNumbers = new Array(byteCharacters.length);
                    for (let i = 0; i < byteCharacters.length; i++) {
                        byteNumbers[i] = byteCharacters.charCodeAt(i);
                    }
                    const byteArray = new Uint8Array(byteNumbers);
                    const blob = new Blob([byteArray], { type: savedFile.type || 'application/octet-stream' });
                    
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = item.fileName || 'download';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    Utils.showToast('Download gestartet!', 'success');
                } catch (e) {
                    console.error('Download-Fehler:', e);
                    Utils.showToast('Download-Fehler', 'error');
                }
            } else {
                Utils.showToast('Keine Datei vorhanden', 'error');
            }
        }

        function handleUpload(e) {
            e.preventDefault();
            const title = document.getElementById('uploadTitle').value.trim();
            const description = document.getElementById('uploadDesc').value.trim();
            const category = document.getElementById('uploadCategory').value;
            const price = Math.max(0, parseInt(document.getElementById('uploadPrice').value) || 0);
            const mcVersions = Array.from(document.querySelectorAll('input[name="mcVersion"]:checked')).map(c => c.value);
            const file = document.getElementById('fileInput').files[0];

            if (title.length < 3) { Utils.showToast('Titel zu kurz', 'error'); return; }
            if (description.length < 10) { Utils.showToast('Beschreibung zu kurz', 'error'); return; }
            if (!file) { Utils.showToast('Bitte Datei ausw√§hlen', 'error'); return; }
            if (file.size > 5 * 1024 * 1024) { Utils.showToast('Datei zu gro√ü (max 5MB)', 'error'); return; }

            const reader = new FileReader();
            reader.onload = function(event) {
                const base64Data = event.target.result.split(',')[1];
                
                const user = DB.getCurrentUser();
                const settings = DB.getSettings();
                const contentId = Utils.generateId();
                
                const newContent = {
                    id: contentId,
                    title, description, category, price, mcVersions,
                    visibility: 'public',
                    fileName: file.name,
                    fileSize: Utils.formatFileSize(file.size),
                    uploaderId: user.id,
                    uploaderName: user.username,
                    downloads: 0,
                    rating: 0,
                    reviews: 0,
                    createdAt: new Date().toISOString(),
                    approved: DB.isAdmin(user) || !settings.requireApproval
                };

                const content = DB.getContent();
                content.push(newContent);
                DB.setContent(content);
                
                DB.saveFile(contentId, { data: base64Data, type: file.type, name: file.name, size: file.size });
                
                if (uploadedImagePreview) {
                    DB.saveImage(contentId, uploadedImagePreview);
                    uploadedImagePreview = null;
                }

                Utils.showToast(DB.isAdmin(user) ? 'Ver√∂ffentlicht!' : 'Hochgeladen - wartet auf Genehmigung');
                Render.navigate('marketplace');
            };
            
            reader.onerror = function() { Utils.showToast('Fehler beim Lesen', 'error'); };
            reader.readAsDataURL(file);
        }

        // ============ ADMIN FUNCTIONS ============
        function adminUpdateSetting(key, value) {
            if (Admin.updateSetting(key, value)) {
                Utils.showToast('Gespeichert');
            }
        }

        function adminSetUserRole(userId, role) {
            if (Admin.setUserRole(userId, role)) {
                Utils.showToast('Rolle ge√§ndert');
                showAdminTab('users');
            }
        }

        function adminSetUserTokens(userId) {
            const tokens = parseInt(document.getElementById('tokens-' + userId).value);
            if (Admin.setTokens(userId, tokens)) {
                Utils.showToast('Tokens aktualisiert');
            }
        }

        function adminDeleteUser(userId) {
            if (confirm('Benutzer l√∂schen?') && Admin.deleteUser(userId)) {
                Utils.showToast('Gel√∂scht');
                showAdminTab('users');
            }
        }

        function adminApproveContent(contentId) {
            if (Admin.approveContent(contentId)) {
                Utils.showToast('Genehmigt');
                Render.app();
            }
        }

        function adminDeleteContent(contentId) {
            if (confirm('Inhalt l√∂schen?') && Admin.deleteContent(contentId)) {
                Utils.showToast('Gel√∂scht');
                Render.navigate('marketplace');
            }
        }

        function adminUpdateContentPrice(contentId) {
            const price = parseInt(document.getElementById('price-' + contentId).value);
            if (Admin.updateContentPrice(contentId, price)) {
                Utils.showToast('Preis aktualisiert');
            }
        }

        function adminGiveTokens() {
            const userId = document.getElementById('giveTokensUser').value;
            const amount = parseInt(document.getElementById('giveTokensAmount').value);
            if (Admin.giveTokens(userId, amount)) {
                Utils.showToast(`+${amount} Tokens vergeben`);
                showAdminTab('tokens');
            }
        }

        function adminTakeTokens() {
            const userId = document.getElementById('giveTokensUser').value;
            const amount = parseInt(document.getElementById('giveTokensAmount').value);
            if (Admin.giveTokens(userId, -amount)) {
                Utils.showToast(`-${amount} Tokens abgezogen`);
                showAdminTab('tokens');
            }
        }

        // ============ LEGAL PAGES ============
        const Legal = {
            showImpressum() {
                showModal(`
                    <h2 class="text-xl font-bold mb-4"><i class="fas fa-gavel mr-2 text-blue-400"></i>Impressum</h2>
                    <div class="space-y-4 text-sm text-gray-300 max-h-80 overflow-y-auto">
                        <div>
                            <h3 class="font-bold text-white">Angaben gem√§√ü ¬ß 5 TMG</h3>
                            <p class="mt-2">TEST!!</p>
                            <p>TEST!! (Stra√üe)</p>
                            <p>TEST!! (PLZ, Stadt)</p>
                        </div>
                        <div>
                            <h3 class="font-bold text-white">Kontakt</h3>
                            <p>Telefon: TEST!!</p>
                            <p>E-Mail: TEST!!</p>
                        </div>
                        <div>
                            <h3 class="font-bold text-white">Umsatzsteuer-ID</h3>
                            <p>Umsatzsteuer-Identifikationsnummer gem√§√ü ¬ß 27 a Umsatzsteuergesetz: TEST!!</p>
                        </div>
                        <div>
                            <h3 class="font-bold text-white">Verantwortlich f√ºr den Inhalt nach ¬ß 55 Abs. 2 RStV</h3>
                            <p>TEST!!</p>
                        </div>
                        <div>
                            <h3 class="font-bold text-white">Streitschlichtung</h3>
                            <p>Die Europ√§ische Kommission stellt eine Plattform zur Online-Streitbeilegung (OS) bereit: 
                            <a href="https://ec.europa.eu/consumers/odr" target="_blank" class="text-green-400 hover:underline">https://ec.europa.eu/consumers/odr</a></p>
                        </div>
                    </div>
                    <button onclick="closeModal()" class="w-full mt-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg transition">Schlie√üen</button>
                `);
            },

            showDatenschutz() {
                showModal(`
                    <h2 class="text-xl font-bold mb-4"><i class="fas fa-shield-alt mr-2 text-green-400"></i>Datenschutzerkl√§rung</h2>
                    <div class="space-y-4 text-sm text-gray-300 max-h-80 overflow-y-auto">
                        <div>
                            <h3 class="font-bold text-white">1. Verantwortlicher</h3>
                            <p>TEST!! (Name, Adresse, E-Mail)</p>
                        </div>
                        <div>
                            <h3 class="font-bold text-white">2. Erhobene Daten</h3>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li>Benutzername (f√ºr die Anzeige)</li>
                                <li>E-Mail-Adresse (f√ºr Login & Kommunikation)</li>
                                <li>Passwort (verschl√ºsselt gespeichert)</li>
                                <li>Token-Guthaben und Transaktionen</li>
                                <li>Kaufhistorie</li>
                                <li>Hochgeladene Inhalte</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-bold text-white">3. Ihre Rechte (DSGVO Art. 15-21)</h3>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li><strong>Auskunft</strong> - Welche Daten wir speichern</li>
                                <li><strong>Berichtigung</strong> - Fehlerhafte Daten korrigieren</li>
                                <li><strong>L√∂schung</strong> - Account und Daten l√∂schen</li>
                                <li><strong>Daten√ºbertragbarkeit</strong> - Daten als JSON exportieren</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-bold text-white">4. Speicherdauer</h3>
                            <p>Daten werden bis zur Account-L√∂schung gespeichert. Logs werden nach 30 Tagen gel√∂scht.</p>
                        </div>
                        <div>
                            <h3 class="font-bold text-white">5. Cookies</h3>
                            <p>Wir verwenden nur technisch notwendige Cookies (Session-ID). Kein Tracking ohne Einwilligung.</p>
                        </div>
                        <div>
                            <h3 class="font-bold text-white">6. Kontakt Datenschutz</h3>
                            <p>E-Mail: TEST!!</p>
                        </div>
                    </div>
                    <button onclick="closeModal()" class="w-full mt-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg transition">Schlie√üen</button>
                `);
            },

            showAGB() {
                showModal(`
                    <h2 class="text-xl font-bold mb-4"><i class="fas fa-file-contract mr-2 text-yellow-400"></i>Allgemeine Gesch√§ftsbedingungen</h2>
                    <div class="space-y-4 text-sm text-gray-300 max-h-80 overflow-y-auto">
                        <div>
                            <h3 class="font-bold text-white">¬ß1 Geltungsbereich</h3>
                            <p>Diese AGB gelten f√ºr alle Nutzer der MCMarket-Plattform.</p>
                        </div>
                        <div>
                            <h3 class="font-bold text-white">¬ß2 Token-System</h3>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li>Tokens haben keinen Echtgeldwert</li>
                                <li>Tokens k√∂nnen nicht ausgezahlt werden</li>
                                <li>Token-Guthaben verf√§llt bei Account-L√∂schung</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-bold text-white">¬ß3 K√§ufe & Downloads</h3>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li>K√§ufe mit Tokens sind endg√ºltig</li>
                                <li>Keine Erstattung nach Kauf</li>
                                <li>Download dauerhaft nach Kauf freigeschaltet</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-bold text-white">¬ß4 Inhalte & Upload</h3>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li>Uploader sind f√ºr ihre Inhalte verantwortlich</li>
                                <li>Keine illegalen oder urheberrechtsverletzenden Inhalte</li>
                                <li>Admin kann Inhalte ohne Vorwarnung entfernen</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-bold text-white">¬ß5 Account</h3>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li>Jeder Nutzer darf nur einen Account haben</li>
                                <li>Account-Sharing ist verboten</li>
                                <li>Bei Versto√ü kann der Account gesperrt werden</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-bold text-white">¬ß6 Haftung</h3>
                            <p>MCMarket haftet nicht f√ºr Sch√§den durch heruntergeladene Inhalte.</p>
                        </div>
                    </div>
                    <button onclick="closeModal()" class="w-full mt-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg transition">Schlie√üen</button>
                `);
            },

            showKontakt() {
                showModal(`
                    <h2 class="text-xl font-bold mb-4"><i class="fas fa-envelope mr-2 text-red-400"></i>Kontakt</h2>
                    <div class="space-y-4">
                        <div class="bg-gray-700/50 rounded-lg p-4">
                            <h3 class="font-bold text-white mb-2"><i class="fas fa-envelope mr-2 text-green-400"></i>E-Mail</h3>
                            <p class="text-gray-300">TEST!!</p>
                        </div>
                        <div class="bg-gray-700/50 rounded-lg p-4">
                            <h3 class="font-bold text-white mb-2"><i class="fab fa-discord mr-2 text-indigo-400"></i>Discord</h3>
                            <p class="text-gray-300">TEST!!</p>
                        </div>
                        <div class="bg-gray-700/50 rounded-lg p-4">
                            <h3 class="font-bold text-white mb-2"><i class="fas fa-clock mr-2 text-yellow-400"></i>Antwortzeit</h3>
                            <p class="text-gray-300">Wir antworten in der Regel innerhalb von 24-48 Stunden.</p>
                        </div>
                        <div class="bg-blue-500/10 border border-blue-500/50 rounded-lg p-4">
                            <p class="text-sm text-blue-300"><i class="fas fa-info-circle mr-2"></i>F√ºr DSGVO-Anfragen nutze bitte den Datenexport in deinem Profil.</p>
                        </div>
                    </div>
                    <button onclick="closeModal()" class="w-full mt-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg transition">Schlie√üen</button>
                `);
            },

            showFAQ() {
                showModal(`
                    <h2 class="text-xl font-bold mb-4"><i class="fas fa-question-circle mr-2 text-purple-400"></i>FAQ / Hilfe</h2>
                    <div class="space-y-3 max-h-80 overflow-y-auto">
                        <details class="bg-gray-700/50 rounded-lg p-4 cursor-pointer">
                            <summary class="font-bold text-white">Wie bekomme ich Tokens?</summary>
                            <p class="text-gray-300 mt-2 text-sm">Du erh√§ltst automatisch Tokens basierend auf dem eingestellten Intervall. Klicke auf den Token-Button wenn er leuchtet.</p>
                        </details>
                        <details class="bg-gray-700/50 rounded-lg p-4 cursor-pointer">
                            <summary class="font-bold text-white">Wie kaufe ich Inhalte?</summary>
                            <p class="text-gray-300 mt-2 text-sm">Klicke auf einen Inhalt und dann auf "Kaufen". Die Tokens werden abgezogen und du kannst sofort herunterladen.</p>
                        </details>
                        <details class="bg-gray-700/50 rounded-lg p-4 cursor-pointer">
                            <summary class="font-bold text-white">Wie l√∂sche ich meinen Account?</summary>
                            <p class="text-gray-300 mt-2 text-sm">Gehe zu Einstellungen ‚Üí "Account l√∂schen". Du musst dein Passwort best√§tigen.</p>
                        </details>
                        <details class="bg-gray-700/50 rounded-lg p-4 cursor-pointer">
                            <summary class="font-bold text-white">Wie exportiere ich meine Daten?</summary>
                            <p class="text-gray-300 mt-2 text-sm">Gehe zu Profil oder Einstellungen ‚Üí "Daten herunterladen". Du erh√§ltst eine JSON-Datei.</p>
                        </details>
                    </div>
                    <button onclick="closeModal()" class="w-full mt-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg transition">Schlie√üen</button>
                `);
            },

            exportUserData() {
                const user = DB.getCurrentUser();
                if (!user) { Utils.showToast('Nicht angemeldet', 'error'); return; }
                
                const purchases = DB.getPurchases().filter(p => p.userId === user.id);
                const transactions = DB.getTransactions().filter(t => t.userId === user.id);
                const uploads = DB.getContent().filter(c => c.uploaderId === user.id);
                
                const exportData = {
                    _info: {
                        exportDate: new Date().toISOString(),
                        exportType: 'DSGVO Art. 15 & 20 - Vollst√§ndige Datenauskunft',
                        platform: 'MCMarket'
                    },
                    personalData: {
                        id: user.id,
                        username: user.username,
                        email: user.email,
                        role: user.role,
                        tokens: isFinite(user.tokens) ? user.tokens : 'Unbegrenzt',
                        accountCreated: user.createdAt,
                        lastTokenClaim: user.lastTokenClaim,
                        permissions: user.permissions,
                        settings: user.settings
                    },
                    purchaseHistory: purchases.map(p => {
                        const content = DB.getContent().find(c => c.id === p.contentId);
                        return { purchaseId: p.id, contentTitle: content ? content.title : 'Gel√∂scht', price: p.price, date: p.date };
                    }),
                    tokenTransactions: transactions,
                    uploadedContent: uploads.map(u => ({ id: u.id, title: u.title, category: u.category, price: u.price, downloads: u.downloads, createdAt: u.createdAt }))
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `mcmarket-daten-${user.username}-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                Utils.showToast('Daten heruntergeladen!', 'success');
            }
        };

        // ============ INIT ============
        DB.init();
        Render.app();
    </script>
</body>
</html>
